{"version":3,"file":"preload.js","sourceRoot":"","sources":["../../../../../src/electron/renderer/preload.ts"],"names":[],"mappings":"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","sourcesContent":["import { ipcRenderer } from \"electron\";\n\nimport { R2_EVENT_LINK, R2_EVENT_READIUMCSS } from \"../common/events\";\n\nconsole.log(\"PRELOAD\");\n\nconst win = (global as any).window as Window;\n\nconsole.log(win.location.pathname);\nconsole.log(win.location.origin);\n\nconst urlRootReadiumCSS = win.location.origin + \"/readium-css/iOS/\";\n\nipcRenderer.on(R2_EVENT_READIUMCSS, (_event: any, messageString: any) => {\n    // console.log(\"ipcRenderer\");\n    // console.log(event);\n    // console.log(messageString);\n    // ipcRenderer.sendToHost(R2_EVENT_READIUMCSS, \"pong\");\n\n    const messageJson = JSON.parse(messageString);\n\n    if (messageJson.injectCSS) {\n        if (!win.document.head) {\n            const headElement = win.document.createElement(\"head\");\n            if (win.document.body) {\n                win.document.documentElement.insertBefore(headElement, win.document.body);\n            } else {\n                win.document.documentElement.appendChild(headElement);\n            }\n        }\n\n        removeAllCSS();\n        if (messageJson.injectCSS.indexOf(\"rollback\") < 0) {\n            // appendCSS(\"base\");\n            // appendCSS(\"html5patch\");\n            // appendCSS(\"safeguards\");\n            // appendCSS(\"default\");\n            // appendCSS(\"highlights\");\n            // if (messageJson.injectCSS.indexOf(\"scroll\") >= 0) {\n            //     appendCSS(\"scroll\");\n            // } else {\n            //     appendCSS(\"pagination\");\n            // }\n            // if (messageJson.injectCSS.indexOf(\"night_mode\") >= 0) {\n            //     appendCSS(\"night_mode\");\n            // } else if (messageJson.injectCSS.indexOf(\"sepia_mode\") >= 0) {\n            //     appendCSS(\"pagination\");\n            // }\n            // appendCSS(\"os_a11y\");\n            // appendCSS(\"user_settings\");\n            // if (messageJson.injectCSS.indexOf(\"fs_normalize\") >= 0) {\n            //     appendCSS(\"fs_normalize\");\n            // }\n\n            appendCSS(\"before\");\n            appendCSS(\"default\");\n            appendCSS(\"after\");\n        }\n    }\n\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/readium/readium-css/tree/develop/prototype/iOS-implem#manage-user-settings\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/readium/readium-css/blob/develop/prototype/iOS-implem/Specific-docs/CSS12-api.md#user-settings\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/readium/readium-css/blob/develop/prototype/iOS-implem/Specific-docs/CSS09-user_prefs.md#switches\n    if (messageJson.setCSS) {\n\n        const docElement = win.document.documentElement;\n\n        if (typeof messageJson.setCSS === \"string\" && messageJson.setCSS.indexOf(\"rollback\") >= 0) {\n\n            docElement.style.overflow = \"auto\";\n\n            const toRemove: string[] = [];\n            for (let i = 0; i < docElement.style.length; i++) {\n                const item = docElement.style.item(i);\n                if (item.indexOf(\"--USER__\") === 0) {\n                    toRemove.push(item);\n                }\n            }\n            toRemove.forEach((item) => {\n                docElement.style.removeProperty(item);\n            });\n        } else {\n            docElement.style.overflow = \"hidden\";\n            // win.document.body.offsetWidth === single column width (takes into account column gap?)\n            // win.document.body.clientWidth === same\n            // win.document.body.scrollWidth === full document width (all columns)\n            //\n            // win.document.body.offsetHeight === full document height (sum of all columns minus trailing blank space?)\n            // win.document.body.clientHeight === same\n            // win.document.body.scrollHeight === visible viewport height\n            //\n            // win.document.body.scrollLeft === positive number for left shift\n\n            // readium-darken-on | readium-darken-off\n            docElement.style.setProperty(\"--USER__darkenFilter\", \"readium-darken-off\");\n\n            // readium-invert-on | readium-invert-off\n            docElement.style.setProperty(\"--USER__invertFilter\", \"readium-invert-off\");\n\n            // readium-advanced-on | readium-advanced-off\n            docElement.style.setProperty(\"--USER__advancedSettings\", \"readium-advanced-on\");\n\n            // readium-font-on | readium-font-off\n            docElement.style.setProperty(\"--USER__fontOverride\", \"readium-font-on\");\n\n            // readium-paged-on | readium-scroll-on\n            docElement.style.setProperty(\"--USER__view\", \"readium-paged-on\");\n\n            // readium-default-on | readium-sepia-on | readium-night-on\n            docElement.style.setProperty(\"--USER__appearance\", \"readium-sepia-on\");\n\n            // left (LTR) or right (RTL) | justify\n            docElement.style.setProperty(\"--USER__textAlign\", \"justify\");\n\n            // auto | none\n            docElement.style.setProperty(\"--USER__bodyHyphens\", \"auto\");\n\n            // var(--RS__oldStyleTf) | var(--RS__modernTf) | var(--RS__sansTf) | var(--RS__humanistTf) | AccessibleDfa\n            docElement.style.setProperty(\"--USER__fontFamily\", \"AccessibleDfa\");\n\n            // 1 | 2 | auto\n            docElement.style.setProperty(\"--USER__colCount\", \"2\");\n\n            // 75% | 87.5% | 100% | 112.5% | 137.5% | 150% | 162.5% | 175% | 200% | 225% | 250%\n            docElement.style.setProperty(\"--USER__fontSize\", \"112.5%\");\n\n            // 1 | 1.067 | 1.125 | 1.2 (suggested default) | 1.25 | 1.333 | 1.414 | 1.5 | 1.618\n            docElement.style.setProperty(\"--USER__typeScale\", \"1.2\");\n\n            // 1 | 1.125 | 1.25 | 1.35 | 1.5 | 1.65 | 1.75 | 2\n            docElement.style.setProperty(\"--USER__lineHeight\", \"2\");\n\n            // 0 | 0.375rem | 0.75rem | 1rem | 1.125rem | 1.25rem | 1.35rem | 1.5rem | 1.65rem | 1.75rem | 2rem\n            docElement.style.setProperty(\"--USER__paraSpacing\", \"1rem\");\n\n            // 0 | 0.5rem | 1rem | 1.25rem | 1.5rem | 2rem | 2.5rem | 3rem\n            docElement.style.setProperty(\"--USER__paraIndent\", \"1rem\");\n\n            // 0.125rem | 0.25rem | 0.375rem | 0.5rem\n            docElement.style.setProperty(\"--USER__wordSpacing\", \"0.5rem\");\n\n            // 0.0675rem | 0.125rem | 0.1875rem | 0.25rem\n            docElement.style.setProperty(\"--USER__letterSpacing\", \"0.1875rem\");\n\n            // 0.5 | 0.75 | 1 | 1.25 | 1.5 | 1.75 | 2\n            docElement.style.setProperty(\"--USER__pageMargins\", \"1.25\");\n\n            docElement.style.setProperty(\"--USER__backgroundColor\", \"#FFFFFF\");\n            docElement.style.setProperty(\"--USER__textColor\", \"#000000\");\n        }\n    }\n});\n\nwin.addEventListener(\"DOMContentLoaded\", () => {\n    console.log(\"PRELOAD DOM READY\");\n\n    win.document.addEventListener(\"click\", (e) => {\n        const href = (e.target as any).href;\n        if (!href) {\n            return;\n        }\n        console.log(\"HREF CLICK: \" + href);\n        e.preventDefault();\n        e.stopPropagation();\n        ipcRenderer.sendToHost(R2_EVENT_LINK, href);\n        return false;\n    }, true);\n\n    // const borderDiv1 = win.document.createElement(\"div\");\n    // borderDiv1.setAttribute(\"id\", \"ReadiumBorderDIV1\");\n    // borderDiv1.setAttribute(\"style\",\n    // tslint:disable-next-line:max-line-length\n    // \"display:block;position:absolute;margin:0;padding:0;box-sizing:border-box;left:3px;right:3px;top:3px;bottom:3px;z-index:1000;background-color:transparent;border:2px solid blue;\");\n    // win.document.body.appendChild(borderDiv1);\n\n    // const borderDiv2 = win.document.createElement(\"div\");\n    // borderDiv2.setAttribute(\"id\", \"ReadiumBorderDIV2\");\n    // borderDiv2.setAttribute(\"style\",\n    // tslint:disable-next-line:max-line-length\n    // \"display:block;position:fixed;margin:0;padding:0;box-sizing:border-box;left:0;top:0;width:100%;height:100%;z-index:900;background-color:transparent;border:2px solid black;\");\n    // // borderDiv2.appendChild(win.document.createTextNode(\"TEST\"));\n    // win.document.body.appendChild(borderDiv2);\n\n    // win.addEventListener(\"scroll\", (e) => {\n    //     console.log(e);\n\n    //     console.log(win.innerWidth);\n    //     console.log(win.innerHeight);\n\n    //     const element = win.document.body; // win.document.documentElement\n    //     if (!element) {\n    //         return;\n    //     }\n\n    //     console.log(element.scrollWidth);\n    //     console.log(element.scrollLeft);\n\n    //     console.log(element.scrollHeight);\n    //     console.log(element.scrollTop);\n    // });\n});\n\nwin.addEventListener(\"resize\", () => {\n    console.log(\"webview resize\");\n    win.document.body.scrollLeft = 0;\n    win.document.body.scrollTop = 0;\n});\n\nfunction appendCSS(mod: string) {\n    const linkElement = win.document.createElement(\"link\");\n    linkElement.setAttribute(\"id\", \"ReadiumCSS-\" + mod);\n    linkElement.setAttribute(\"rel\", \"stylesheet\");\n    linkElement.setAttribute(\"type\", \"text/css\");\n    linkElement.setAttribute(\"href\", urlRootReadiumCSS + \"ReadiumCSS-\" + mod + \".css\");\n    win.document.head.appendChild(linkElement);\n}\n\nfunction removeCSS(mod: string) {\n    const linkElement = win.document.getElementById(\"ReadiumCSS-\" + mod);\n    if (linkElement && linkElement.parentNode) {\n        linkElement.parentNode.removeChild(linkElement);\n    }\n}\n\nfunction removeAllCSS() {\n    removeCSS(\"before\");\n    removeCSS(\"after\");\n    removeCSS(\"base\");\n    removeCSS(\"html5patch\");\n    removeCSS(\"safeguards\");\n    removeCSS(\"default\");\n    removeCSS(\"highlights\");\n    removeCSS(\"scroll\");\n    removeCSS(\"pagination\");\n    removeCSS(\"night_mode\");\n    removeCSS(\"pagination\");\n    removeCSS(\"os_a11y\");\n    removeCSS(\"user_settings\");\n    removeCSS(\"fs_normalize\");\n}\n"]}