{"version":3,"file":"preload.js","sourceRoot":"","sources":["../../../../../../src/electron/renderer/webview/preload.ts"],"names":[],"mappings":"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","sourcesContent":["import debounce = require(\"debounce\");\nimport ResizeSensor = require(\"resize-sensor/ResizeSensor\");\n\nimport {\n    DEBUG_VISUALS,\n    injectDefaultCSS,\n    injectReadPosCSS,\n    readiumCSS,\n} from \"@r2-streamer-js/electron/renderer/webview/readium-css\";\nimport { ipcRenderer } from \"electron\";\n\nimport {\n    R2_EVENT_LINK,\n    R2_EVENT_PAGE_TURN,\n    R2_EVENT_PAGE_TURN_RES,\n    R2_EVENT_READING_LOCATION,\n    R2_EVENT_SCROLLTO,\n    R2_EVENT_WEBVIEW_READY,\n} from \"../../common/events\";\nimport { animateProperty } from \"../common/animateProperty\";\nimport { fullQualifiedSelector } from \"../common/cssselector\";\nimport { easings } from \"../common/easings\";\nimport { getURLQueryParams } from \"../common/querystring\";\n\nconst win = (global as any).window as Window;\n\nlet queryParams = win.location.search ? getURLQueryParams(win.location.search) : undefined;\n\n// console.log(\"-----\");\n// console.log(win.location.href);\n// console.log(win.location.origin);\n// console.log(win.location.pathname);\n// console.log(win.location.search);\n// console.log(win.location.hash);\n\nlet _hashElement: Element | null;\n\nipcRenderer.on(R2_EVENT_SCROLLTO, (_event: any, messageString: any) => {\n    console.log(\"R2_EVENT_SCROLLTO\");\n    console.log(messageString);\n\n    const messageJson = JSON.parse(messageString);\n    if (!queryParams) {\n        queryParams = {};\n    }\n    if (messageJson.previous) {\n        // tslint:disable-next-line:no-string-literal\n        queryParams[\"readiumprevious\"] = \"true\";\n    } else {\n        // tslint:disable-next-line:no-string-literal\n        if (typeof queryParams[\"readiumprevious\"] !== \"undefined\") {\n            // tslint:disable-next-line:no-string-literal\n            delete queryParams[\"readiumprevious\"];\n        }\n    }\n    if (messageJson.goto) {\n        // tslint:disable-next-line:no-string-literal\n        queryParams[\"readiumgoto\"] = \"true\";\n    } else {\n        // tslint:disable-next-line:no-string-literal\n        if (typeof queryParams[\"readiumgoto\"] !== \"undefined\") {\n            // tslint:disable-next-line:no-string-literal\n            delete queryParams[\"readiumgoto\"];\n        }\n    }\n    if (messageJson.hash) {\n        _hashElement = win.document.getElementById(messageJson.hash);\n    } else {\n        _hashElement = null;\n    }\n\n    _readyEventSent = false;\n    _locationHashOverride = undefined;\n    scrollToHashRaw(false);\n\n    // ipcRenderer.sendToHost(R2_EVENT_WEBVIEW_READY, win.location.href);\n    // notifyReadingLocation();\n});\n\nipcRenderer.on(R2_EVENT_PAGE_TURN, (_event: any, messageString: any) => {\n    const element = win.document.body;\n    if (!element) {\n        return;\n    }\n    // console.log(\"---\");\n    // console.log(\"webview.innerWidth: \" + win.innerWidth);\n    // console.log(\"document.offsetWidth: \" + win.document.documentElement.offsetWidth);\n    // console.log(\"document.clientWidth: \" + win.document.documentElement.clientWidth);\n    // console.log(\"document.scrollWidth: \" + win.document.documentElement.scrollWidth);\n    // console.log(\"document.scrollLeft: \" + win.document.documentElement.scrollLeft);\n    // console.log(\"body.offsetWidth: \" + element.offsetWidth);\n    // console.log(\"body.clientWidth: \" + element.clientWidth);\n    // console.log(\"body.scrollWidth: \" + element.scrollWidth);\n    // console.log(\"body.scrollLeft: \" + element.scrollLeft);\n    // console.log(\"---\");\n    // console.log(\"webview.innerHeight: \" + win.innerHeight);\n    // console.log(\"document.offsetHeight: \" + win.document.documentElement.offsetHeight);\n    // console.log(\"document.clientHeight: \" + win.document.documentElement.clientHeight);\n    // console.log(\"document.scrollHeight: \" + win.document.documentElement.scrollHeight);\n    // console.log(\"document.scrollTop: \" + win.document.documentElement.scrollTop);\n    // console.log(\"body.offsetHeight: \" + element.offsetHeight);\n    // console.log(\"body.clientHeight: \" + element.clientHeight);\n    // console.log(\"body.scrollHeight: \" + element.scrollHeight);\n    // console.log(\"body.scrollTop: \" + element.scrollTop);\n    // console.log(\"---\");\n\n    // win.document.body.offsetWidth === single column width (takes into account column gap?)\n    // win.document.body.clientWidth === same\n    // win.document.body.scrollWidth === full document width (all columns)\n    //\n    // win.document.body.offsetHeight === full document height (sum of all columns minus trailing blank space?)\n    // win.document.body.clientHeight === same\n    // win.document.body.scrollHeight === visible viewport height\n    //\n    // win.document.body.scrollLeft === positive number for horizontal shift\n    // win.document.body.scrollTop === positive number for vertical shift\n\n    const maxHeightShift = element.scrollHeight - win.document.documentElement.clientHeight;\n\n    const messageJson = JSON.parse(messageString);\n    // const isRTL = messageJson.direction === \"RTL\"; //  any other value is LTR\n    const goPREVIOUS = messageJson.go === \"PREVIOUS\"; // any other value is NEXT\n\n    // console.log(JSON.stringify(messageJson, null, \"  \"));\n\n    if (!goPREVIOUS) { // goPREVIOUS && isRTL || !goPREVIOUS && !isRTL) { // right\n        if (element.scrollTop < maxHeightShift) { // not at bottom\n            animateProperty(\n                win.cancelAnimationFrame,\n                undefined,\n                // (cancelled: boolean) => {\n                //     console.log(cancelled);\n                // },\n                \"scrollTop\",\n                300,\n                element,\n                element.scrollTop + win.document.documentElement.clientHeight,\n                win.requestAnimationFrame,\n                easings.easeInOutQuad,\n            );\n            // element.scrollTop += win.document.documentElement.clientHeight;\n            return;\n        }\n    } else if (goPREVIOUS) { //  && !isRTL || !goPREVIOUS && isRTL) { // left\n        if (element.scrollTop > 0) { // not at top\n            animateProperty(\n                win.cancelAnimationFrame,\n                undefined,\n                // (cancelled: boolean) => {\n                //     console.log(cancelled);\n                // },\n                \"scrollTop\",\n                300,\n                element,\n                element.scrollTop - win.document.documentElement.clientHeight,\n                win.requestAnimationFrame,\n                easings.easeInOutQuad,\n            );\n            // element.scrollTop -= win.document.documentElement.clientHeight;\n            return;\n        }\n    }\n\n    ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, messageString);\n});\n\nconst checkReadyPass = () => {\n    if (_readyPassDone) {\n        return;\n    }\n    _readyPassDone = true;\n\n    if (DEBUG_VISUALS) {\n        if (_hashElement) {\n            _hashElement.classList.add(\"readium2-read-pos\");\n        }\n    }\n\n    win.addEventListener(\"resize\", () => {\n        scrollToHash();\n    });\n\n    // const docElement = win.document.documentElement;\n    // let skipFirstResize = docElement.getAttribute(\"data-readiumcss\") || false;\n    // let skipFirstScroll = skipFirstResize;\n\n    setTimeout(() => {\n        scrollToHashRaw(true);\n\n        win.addEventListener(\"scroll\", (_ev: Event) => {\n\n            if (_ignoreScrollEvent) {\n                _ignoreScrollEvent = false;\n                return;\n            }\n            // if (skipFirstScroll) {\n            //     skipFirstScroll = false;\n            //     return;\n            // }\n\n            processXY(0, 0);\n        });\n\n    }, 800);\n\n    const useResizeSensor = true;\n    if (useResizeSensor && win.document.body) {\n\n        setTimeout(() => {\n            window.requestAnimationFrame((_timestamp) => {\n                // new (win as any).\n                // tslint:disable-next-line:no-unused-expression\n                new ResizeSensor(win.document.body, () => {\n\n                    console.log(\"ResizeSensor\");\n\n                    scrollToHash();\n\n                    // if (skipFirstResize) {\n                    //     console.log(\"ResizeSensor SKIP FIRST\");\n\n                    //     skipFirstResize = false;\n                    //     return;\n                    // } else {\n                    //     console.log(\"ResizeSensor\");\n                    // }\n                });\n            });\n        }, 2000);\n    }\n\n    if (win.document.body) {\n\n        win.document.body.addEventListener(\"click\", (ev: MouseEvent) => {\n\n            const x = ev.clientX; // win.document.body.scrollLeft;\n            const y = ev.clientY; // win.document.body.scrollTop;\n\n            processXY(x, y);\n        });\n    }\n};\n\nconst notifyReady = () => {\n    if (_readyEventSent) {\n        return;\n    }\n    _readyEventSent = true;\n\n    ipcRenderer.sendToHost(R2_EVENT_WEBVIEW_READY, win.location.href);\n};\n\nconst scrollToHashRaw = (firstCall: boolean) => {\n\n    console.log(\"scrollToHash: \" + firstCall);\n\n    if (_locationHashOverride) {\n\n        console.log(\"_locationHashOverride\");\n\n        if (_locationHashOverride === win.document.body) {\n            console.log(\"body...\");\n\n            return;\n        }\n\n        notifyReady();\n        notifyReadingLocation();\n\n        _ignoreScrollEvent = true;\n        _locationHashOverride.scrollIntoView({\n            behavior: \"instant\",\n            block: \"start\",\n            inline: \"nearest\",\n        });\n\n        return;\n    } else if (_hashElement) {\n\n        console.log(\"_hashElement\");\n\n        _locationHashOverride = _hashElement;\n        // _locationHashOverrideCSSselector = fullQualifiedSelector(_locationHashOverride, false);\n\n        notifyReady();\n        notifyReadingLocation();\n\n        if (!firstCall) {\n            _ignoreScrollEvent = true;\n            _hashElement.scrollIntoView({\n                behavior: \"instant\",\n                block: \"start\",\n                inline: \"nearest\",\n            });\n        }\n\n        // _hashElement.classList.add(\"readium2-hash\");\n        // setTimeout(() => {\n        //     if (_hashElement) {\n        //         _hashElement.classList.remove(\"readium2-hash\");\n        //     }\n        // }, 1000);\n\n        return;\n    } else {\n        if (win.document.body) {\n\n            if (queryParams) {\n                // tslint:disable-next-line:no-string-literal\n                const previous = queryParams[\"readiumprevious\"];\n                const isPreviousNavDirection = previous === \"true\";\n                if (isPreviousNavDirection) {\n\n                    console.log(\"readiumprevious\");\n\n                    const maxHeightShift = win.document.body.scrollHeight - win.document.documentElement.clientHeight;\n\n                    _ignoreScrollEvent = true;\n                    win.document.body.scrollLeft = 0;\n                    win.document.body.scrollTop = maxHeightShift;\n\n                    _locationHashOverride = undefined;\n                    _locationHashOverrideCSSselector = undefined;\n                    processXYRaw(0, win.document.documentElement.clientHeight - 1);\n\n                    console.log(\"BOTTOM (previous):\");\n                    console.log(_locationHashOverride);\n\n                    notifyReady();\n                    notifyReadingLocation();\n                    return;\n                }\n\n                // tslint:disable-next-line:no-string-literal\n                let gotoCssSelector = queryParams[\"readiumgoto\"];\n                if (gotoCssSelector) {\n                    gotoCssSelector = gotoCssSelector.replace(/\\+/g, \" \");\n                    // console.log(\"GOTO: \" + gotoCssSelector);\n                    let selected: Element | null = null;\n                    try {\n                        selected = document.querySelector(gotoCssSelector);\n                    } catch (err) {\n                        console.log(err);\n                    }\n                    if (selected) {\n\n                        console.log(\"readiumgoto\");\n\n                        _locationHashOverride = selected;\n                        _locationHashOverrideCSSselector = gotoCssSelector;\n\n                        notifyReady();\n                        notifyReadingLocation();\n\n                        _ignoreScrollEvent = true;\n                        selected.scrollIntoView({\n                            behavior: \"instant\",\n                            block: \"start\",\n                            inline: \"nearest\",\n                        });\n\n                        return;\n                    }\n                }\n            }\n\n            console.log(\"_locationHashOverride = win.document.body\");\n\n            _locationHashOverride = win.document.body;\n            _locationHashOverrideCSSselector = undefined;\n\n            _ignoreScrollEvent = true;\n            win.document.body.scrollLeft = 0;\n            win.document.body.scrollTop = 0;\n        }\n    }\n\n    notifyReady();\n    notifyReadingLocation();\n};\n\nconst scrollToHash = debounce(() => {\n    scrollToHashRaw(false);\n}, 500);\n\nlet _ignoreScrollEvent = false;\n\n// const injectResizeSensor = () => {\n//     ensureHead();\n//     const scriptElement = win.document.createElement(\"script\");\n//     scriptElement.setAttribute(\"id\", \"Readium2-ResizeSensor\");\n//     scriptElement.setAttribute(\"type\", \"application/javascript\");\n//     scriptElement.setAttribute(\"src\", urlResizeSensor);\n//     scriptElement.appendChild(win.document.createTextNode(\" \"));\n//     win.document.head.appendChild(scriptElement);\n//     scriptElement.addEventListener(\"load\", () => {\n//         console.log(\"ResizeSensor LOADED\");\n//     });\n// };\n\nlet _locationHashOverride: Element | undefined;\nlet _locationHashOverrideCSSselector: string | undefined;\nlet _readyPassDone = false;\nlet _readyEventSent = false;\n\nconst resetInitialState = () => {\n    _locationHashOverride = undefined;\n    _readyPassDone = false;\n    _readyEventSent = false;\n};\n\n// after DOMContentLoaded\nwin.addEventListener(\"load\", () => {\n    // console.log(\"PRELOAD WIN LOAD\");\n    checkReadyPass();\n});\n\n// // does not occur when re-using same webview (src=\"href\")\n// win.addEventListener(\"unload\", () => {\n//     console.log(\"PRELOAD WIN UNLOAD\");\n//     resetInitialState();\n// });\n\nwin.addEventListener(\"DOMContentLoaded\", () => {\n\n    if (win.location.hash && win.location.hash.length > 1) {\n        _hashElement = win.document.getElementById(win.location.hash.substr(1));\n    }\n\n    resetInitialState();\n\n    injectDefaultCSS();\n\n    if (DEBUG_VISUALS) {\n        injectReadPosCSS();\n    }\n\n    win.document.addEventListener(\"click\", (e) => {\n        const href = (e.target as any).href;\n        if (!href) {\n            return;\n        }\n\n        // console.log(\"+++++\");\n        // console.log(href);\n\n        e.preventDefault();\n        e.stopPropagation();\n        ipcRenderer.sendToHost(R2_EVENT_LINK, href);\n        return false;\n    }, true);\n\n    // injectResizeSensor();\n\n    // const linkUri = new URI(win.location.href);\n    try {\n        if (queryParams) {\n            // tslint:disable-next-line:no-string-literal\n            const base64 = queryParams[\"readiumcss\"];\n            // if (!base64) {\n            //     console.log(\"!readiumcss BASE64 ??!\");\n            //     const token = \"readiumcss=\";\n            //     const i = win.location.search.indexOf(token);\n            //     if (i > 0) {\n            //         base64 = win.location.search.substr(i + token.length);\n            //         const j = base64.indexOf(\"&\");\n            //         if (j > 0) {\n            //             base64 = base64.substr(0, j);\n            //         }\n            //         base64 = decodeURIComponent(base64);\n            //     }\n            // }\n            if (base64) {\n                // console.log(base64);\n                const str = window.atob(base64);\n                // console.log(str);\n\n                const messageJson = JSON.parse(str);\n                // console.log(messageJson);\n\n                readiumCSS(messageJson);\n            }\n        }\n    } catch (err) {\n        console.log(err);\n    }\n});\n\nconst processXYRaw = (x: number, y: number) => {\n    console.log(\"processXY\");\n\n    // const elems = document.elementsFromPoint(x, y);\n    // // console.log(elems);\n    // let element: Element | undefined = elems && elems.length ? elems[0] : undefined;\n    let element: Element | undefined;\n\n    // if ((document as any).caretPositionFromPoint) {\n    //     console.log(\"caretPositionFromPoint\");\n    //     const range = (document as any).caretPositionFromPoint(x, y);\n    //     const node = range.offsetNode;\n    //     const offset = range.offset;\n    // } else if (document.caretRangeFromPoint) {\n    //     console.log(\"caretRangeFromPoint\");\n    // }\n\n    let textNode: Node | undefined;\n    let textNodeOffset = 0;\n\n    const range = document.caretRangeFromPoint(x, y);\n    if (range) {\n        const node = range.startContainer;\n        const offset = range.startOffset;\n\n        if (node) {\n            if (node.nodeType === Node.ELEMENT_NODE) {\n                element = node as Element;\n            } else if (node.nodeType === Node.TEXT_NODE) {\n                textNode = node;\n                textNodeOffset = offset;\n                if (node.parentNode && node.parentNode.nodeType === Node.ELEMENT_NODE) {\n                    element = node.parentNode as Element;\n                }\n            }\n        }\n    }\n\n    if (DEBUG_VISUALS) {\n        const existings = document.querySelectorAll(\".readium2-read-pos, .readium2-read-pos2\");\n        existings.forEach((existing) => {\n            existing.classList.remove(\"readium2-read-pos\");\n            existing.classList.remove(\"readium2-read-pos2\");\n        });\n    }\n    if (element) {\n        _locationHashOverride = element;\n        notifyReadingLocation();\n\n        if (DEBUG_VISUALS) {\n            element.classList.add(\"readium2-read-pos2\");\n\n            // // console.log(\"fullQualifiedSelector TRUE\");\n            // // const sel1 = fullQualifiedSelector(element, true);\n            // // console.log(sel1);\n\n            // // console.log(\"fullQualifiedSelector FALSE\");\n            // const sel2 = fullQualifiedSelector(element, false);\n            // // console.log(sel2);\n\n            // const selecteds = document.querySelectorAll(sel2);\n            // selecteds.forEach((selected) => {\n            //     selected.classList.remove(\"readium2-read-pos\");\n            //     selected.classList.add(\"readium2-read-pos2\");\n            // });\n        }\n    }\n};\nconst processXY = debounce((x: number, y: number) => {\n    processXYRaw(x, y);\n}, 300);\n\nconst notifyReadingLocation = () => {\n    if (!_locationHashOverride) {\n        return;\n    }\n    _locationHashOverrideCSSselector = fullQualifiedSelector(_locationHashOverride, false);\n    ipcRenderer.sendToHost(R2_EVENT_READING_LOCATION, _locationHashOverrideCSSselector);\n};\n"]}