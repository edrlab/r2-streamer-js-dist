{"version":3,"file":"server-trailing-slash-redirect.js","sourceRoot":"","sources":["../../../../src/http/server-trailing-slash-redirect.ts"],"names":[],"mappings":";;AAAA,gCAAgC;AAGhC,MAAM,KAAK,GAAG,MAAM,CAAC,gBAAgB,CAAC,CAAC;AAGvC,+BAAsC,GAAoB,EAAE,GAAqB,EAAE,IAA0B;IAEzG,MAAM,CAAC,GAAG,GAAG,CAAC,WAAW,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;IAEvC,IAAI,gBAAgB,GAAG,GAAG,CAAC,WAAW,CAAC;IACvC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACT,gBAAgB,GAAG,gBAAgB,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IACrD,CAAC;IACD,EAAE,CAAC,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG;WAChC,gBAAgB,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACxC,MAAM,CAAC,IAAI,EAAE,CAAC;IAClB,CAAC;IAED,IAAI,QAAQ,GAAG,gBAAgB,GAAG,GAAG,CAAC;IACtC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACT,QAAQ,IAAI,GAAG,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;IAC1C,CAAC;IAKD,KAAK,CAAC,aAAa,GAAG,CAAC,WAAW,QAAQ,QAAQ,EAAE,CAAC,CAAC;IACtD,GAAG,CAAC,QAAQ,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;AAChC,CAAC;AAvBD,sDAuBC","sourcesContent":["import * as debug_ from \"debug\";\r\nimport * as express from \"express\";\r\n\r\nconst debug = debug_(\"r2:server:main\");\r\n\r\n// https://github.com/avinoamr/connect-slashes\r\nexport function trailingSlashRedirect(req: express.Request, res: express.Response, next: express.NextFunction) {\r\n\r\n    const i = req.originalUrl.indexOf(\"?\");\r\n\r\n    let pathWithoutQuery = req.originalUrl;\r\n    if (i >= 0) {\r\n        pathWithoutQuery = pathWithoutQuery.substr(0, i);\r\n    }\r\n    if (pathWithoutQuery.substr(-1) === \"/\"\r\n        || pathWithoutQuery.indexOf(\".\") >= 0) {\r\n        return next();\r\n    }\r\n\r\n    let redirect = pathWithoutQuery + \"/\";\r\n    if (i >= 0) {\r\n        redirect += req.originalUrl.substr(i);\r\n    }\r\n\r\n    // Note that the HTTP 301 redirect does not contain CORS headers\r\n    // server.setResponseCORS(res);\r\n\r\n    debug(`REDIRECT: ${req.originalUrl} ==> ${redirect}`);\r\n    res.redirect(301, redirect);\r\n}\r\n"]}