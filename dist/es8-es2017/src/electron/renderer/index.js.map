{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/electron/renderer/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { getURLQueryParams } from \"./querystring\";\n\nconsole.log(\"INDEX\");\n\nconsole.log(window.location);\nconsole.log(document.baseURI);\nconsole.log(document.URL);\n\nwindow.onerror = (err) => {\n    console.log(\"Error\", err);\n};\n\nwindow.addEventListener(\"DOMContentLoaded\", () => {\n\n    const queryParams = getURLQueryParams();\n\n    // tslint:disable-next-line:no-string-literal\n    const publicationJsonUrl = queryParams[\"pub\"];\n\n    console.log(\" (((( publicationJsonUrl )))) \" + publicationJsonUrl);\n\n    const webview1 = document.createElement(\"webview\");\n    webview1.addEventListener(\"dom-ready\", () => {\n        webview1.openDevTools();\n    });\n    webview1.setAttribute(\"id\", \"webview1\");\n    webview1.setAttribute(\"style\",\n        \"width: 100%; height: 400px;\" +\n        \"box-sizing: border-box; border: 2px solid black\");\n    webview1.setAttribute(\"webpreferences\",\n        \"nodeIntegration=0, nodeIntegrationInWorker=0, sandbox=0, \" +\n        \"contextIsolation=0, webSecurity=1, allowRunningInsecureContent=0\");\n    // webview1.setAttribute(\"preload\", \"./preload.js\");\n    // webview.setAttribute(\"src\", \"dummy\");\n    document.body.appendChild(webview1);\n\n    const webview2 = document.createElement(\"webview\");\n    // webview2.addEventListener('did-start-loading', () => {\n    // });\n    // webview2.addEventListener('did-stop-loading', () => {\n    // });\n    // webview2.addEventListener('did-finish-load', () => {\n    // });\n\n    webview2.addEventListener(\"dom-ready\", () => {\n\n        webview2.openDevTools();\n        // const wc = webview2.getWebContents();\n\n        setTimeout(async () => {\n            document.body.setAttribute(\"style\", \"background-color: silver; margin: 0; padding: 0;\");\n\n            const h1 = document.querySelector(\"html > body > h1\");\n            if (!h1) {\n                return;\n            }\n            h1.setAttribute(\"style\", \"color: green;\");\n\n            try {\n\n                // hacky :) (just for testing);\n                // (initializes the LCP pass)\n                await fetch(publicationJsonUrl.replace(\"/pub/\",\n                    \"/pub/*-\" +\n                    \"ZWM0ZjJkYmIzYjE0MDA5NTU1MGM5YWZiYmI2OWI1ZDZmZDllODE0YjlkYTgyZmFkMGIzNGU5ZmNiZTU2ZjFjYg\" +\n                    \"==-*\"));\n\n                const response = await fetch(publicationJsonUrl);\n                if (!response.ok) {\n                    console.log(\"BAD RESPONSE?!\");\n                }\n                response.headers.forEach((arg0: any, arg1: any) => {\n                    console.log(arg0 + \" => \" + arg1);\n                });\n\n                const publicationJson = await response.json();\n                console.log(publicationJson);\n\n                publicationJson.spine.forEach((spineItem: any) => {\n                    const spineItemLink = document.createElement(\"a\");\n                    const spineItemLinkHref = publicationJsonUrl + \"/../\" + spineItem.href;\n                    spineItemLink.setAttribute(\"href\", spineItemLinkHref);\n                    spineItemLink.addEventListener(\"click\", (event) => {\n                        webview1.setAttribute(\"src\", spineItemLinkHref);\n                        event.preventDefault();\n                    });\n                    spineItemLink.appendChild(document.createTextNode(spineItem.href));\n                    document.body.appendChild(spineItemLink);\n                    document.body.appendChild(document.createElement(\"br\"));\n                });\n\n                //     const spineItemUrl = publicationJsonUrl + \"/../\" + publicationJson.spine[0].href;\n                //     console.log(spineItemUrl);\n                //     webview1.setAttribute(\"src\", spineItemUrl);\n\n                // const a = document.querySelector(\"html > body > a\");\n                // a.click();\n            } catch (e) {\n                console.log(e);\n            }\n        }, 5000);\n    });\n    webview2.setAttribute(\"id\", \"webview2\");\n    webview2.setAttribute(\"style\",\n        \"display: inline-flex; visibilityx: hidden; width: 100%; height: 50px; \" +\n        \"box-sizing: border-box; border: 2px solid magenta\");\n    webview2.setAttribute(\"webpreferences\",\n        \"nodeIntegration=0, nodeIntegrationInWorker=0, sandbox=0, \" +\n        \"contextIsolation=0, webSecurity=1, allowRunningInsecureContent=0\");\n    webview2.setAttribute(\"preload\", \"./preload.js\");\n    document.body.appendChild(webview2);\n\n    // const swBootUrl = publicationJsonUrl + \"/show/metadata\";\n    // const swBootUrl = publicationJsonUrl;\n    const swBootUrl = publicationJsonUrl + \"/../\";\n    console.log(swBootUrl);\n\n    webview2.setAttribute(\"src\", swBootUrl);\n});\n"]}