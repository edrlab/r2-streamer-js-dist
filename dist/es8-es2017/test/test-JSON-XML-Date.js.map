{"version":3,"file":"test-JSON-XML-Date.js","sourceRoot":"","sources":["../../../test/test-JSON-XML-Date.ts"],"names":[],"mappings":";;AAAA,6BAA6B;AAE7B,uDAA+C;AAC/C,qFAAgF;AAChF,wDAA2C;AAC3C,6BAA2B;AAC3B,qCAAyC;AACzC,iCAAiC;AAEjC,0CAA0D;AAC1D,sDAAkD;AAClD,uCAMmB;AAEnB,0BAAW,EAAE,CAAC;AACd,4BAAsB,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,EAAE,KAAK,EAAE,UAAU,CAAC,CAAC,CAAC;AAIpE,MAAM,IAAI,GAAG,IAAI,IAAI,EAAE,CAAC;AAExB,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;AAElC,IAAI,CAAC,WAAW,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAG,CAAC,CAAC;AAElC,MAAM,OAAO,GAAG,0BAA0B,CAAC;AAI3C,UAAI,CAAC,0DAA0D,EAAE,CAAC,CAAC,EAAE,EAAE;IAEnE,MAAM,EAAE,GAAG,IAAI,mDAAuB,EAAE,CAAC;IACzC,EAAE,CAAC,QAAQ,GAAG,IAAI,CAAC;IACnB,iBAAO,CAAC,EAAE,CAAC,CAAC;IAEZ,MAAM,IAAI,GAAG,cAAM,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;IAClC,iBAAO,CAAC,IAAI,CAAC,CAAC;IAEd,0BAAgB,CAAC,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;IACnC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;AACjC,CAAC,CAAC,CAAC;AAIH,UAAI,CAAC,4DAA4D,EAAE,CAAC,CAAC,EAAE,EAAE;IAErE,MAAM,IAAI,GAAQ,EAAE,CAAC;IACrB,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC;IACxB,iBAAO,CAAC,IAAI,CAAC,CAAC;IAEd,MAAM,EAAE,GAA4B,cAAM,CAAC,WAAW,CAA0B,IAAI,EAAE,mDAAuB,CAAC,CAAC;IAC/G,iBAAO,CAAC,EAAE,CAAC,CAAC;IAEZ,mBAAS,CAAC,CAAC,EAAE,EAAE,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;IAChC,mBAAS,CAAC,CAAC,EAAE,EAAE,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;AACpC,CAAC,CAAC,CAAC;AAqBH,UAAI,CAAC,6CAA6C,EAAE,CAAC,CAAC,EAAE,EAAE;IAEtD,MAAM,MAAM,GACR;4BACoB,OAAO;iBAClB,CAAC;IACd,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;IAEpB,MAAM,GAAG,GAAG,IAAI,MAAM,CAAC,SAAS,EAAE,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC;IAC3D,MAAM,EAAE,GAAU,mBAAG,CAAC,WAAW,CAAQ,GAAG,EAAE,kBAAK,CAAC,CAAC;IACrD,iBAAO,CAAC,EAAE,CAAC,CAAC;IAEZ,mBAAS,CAAC,CAAC,EAAE,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;IAC/B,mBAAS,CAAC,CAAC,EAAE,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;AACnC,CAAC,CAAC,CAAC","sourcesContent":["import * as path from \"path\";\r\n\r\nimport { Entry } from \"@opds/opds1/opds-entry\";\r\nimport { OPDSPublicationMetadata } from \"@opds/opds2/opds2-publicationMetadata\";\r\nimport { XML } from \"@utils/xml-js-mapper\";\r\nimport { test } from \"ava\";\r\nimport { JSON as TAJSON } from \"ta-json\";\r\nimport * as xmldom from \"xmldom\";\r\n\r\nimport { setLcpNativePluginPath } from \"@parser/epub/lcp\";\r\nimport { initGlobals } from \"../src/init-globals\";\r\nimport {\r\n    checkDate,\r\n    checkType,\r\n    checkType_String,\r\n    inspect,\r\n    logJSON,\r\n} from \"./helpers\";\r\n\r\ninitGlobals();\r\nsetLcpNativePluginPath(path.join(process.cwd(), \"LCP\", \"lcp.node\"));\r\n\r\n// ==========================\r\n\r\nconst date = new Date();\r\n// 31st December (0-based index) 2000\r\ndate.setUTCFullYear(2000, 11, 31);\r\n// 23 hours, 59 minutes, 59 seconds, 999 milliseconds\r\ndate.setUTCHours(23, 59, 59, 999);\r\n\r\nconst dateSTR = \"2000-12-31T23:59:59.999Z\";\r\n\r\n// ==========================\r\n\r\ntest(\"JSON SERIALIZE: OPDSPublicationMetadata.Modified => Date\", (t) => {\r\n\r\n    const md = new OPDSPublicationMetadata();\r\n    md.Modified = date;\r\n    inspect(md);\r\n\r\n    const json = TAJSON.serialize(md);\r\n    logJSON(json);\r\n\r\n    checkType_String(t, json.modified);\r\n    t.is(json.modified, dateSTR);\r\n});\r\n\r\n// ==========================\r\n\r\ntest(\"JSON DESERIALIZE: OPDSPublicationMetadata.Modified => Date\", (t) => {\r\n\r\n    const json: any = {};\r\n    json.modified = dateSTR;\r\n    logJSON(json);\r\n\r\n    const md: OPDSPublicationMetadata = TAJSON.deserialize<OPDSPublicationMetadata>(json, OPDSPublicationMetadata);\r\n    inspect(md);\r\n\r\n    checkType(t, md.Modified, Date);\r\n    checkDate(t, md.Modified, date);\r\n});\r\n\r\n// ==========================\r\n\r\n// SERIALIZATION not implemented in xml-js-mapper!\r\n// test(\"XML SERIALIZE: OPDS Entry.Updated => Date\", (t) => {\r\n\r\n//     const e = new Entry();\r\n//     e.Updated = date;\r\n//     inspect(e);\r\n\r\n//     const xml = XML.serialize(e);\r\n//     logXML(xml);\r\n\r\n//     const xmlProp = xml.select(\"atom:updated/text()\");\r\n//     checkType_String(t, xmlProp);\r\n//     t.is(xmlProp, dateSTR);\r\n// });\r\n\r\n// ==========================\r\n\r\ntest(\"XML DESERIALIZE: OPDS Entry.Updated => Date\", (t) => {\r\n\r\n    const xmlStr =\r\n        `<entry xmlns=\"http://opds-spec.org/2010/catalog\" xmlns:atom=\"http://www.w3.org/2005/Atom\">\r\n            <atom:updated>${dateSTR}</atom:updated>\r\n        </entry>`;\r\n    console.log(xmlStr);\r\n\r\n    const xml = new xmldom.DOMParser().parseFromString(xmlStr);\r\n    const md: Entry = XML.deserialize<Entry>(xml, Entry);\r\n    inspect(md);\r\n\r\n    checkType(t, md.Updated, Date);\r\n    checkDate(t, md.Updated, date);\r\n});\r\n"]}