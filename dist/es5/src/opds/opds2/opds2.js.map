{"version":3,"file":"opds2.js","sourceRoot":"","sources":["../../../../../src/opds/opds2/opds2.ts"],"names":[],"mappings":"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","sourcesContent":["import { JsonStringConverter } from \"@utils/ta-json-string-converter\";\r\n// https://github.com/edcarroll/ta-json\r\nimport {\r\n    JsonConverter,\r\n    JsonElementType,\r\n    JsonObject,\r\n    JsonProperty,\r\n    OnDeserialized,\r\n} from \"ta-json\";\r\n\r\nimport { OPDSFacet } from \"./opds2-facet\";\r\nimport { OPDSGroup } from \"./opds2-group\";\r\nimport { OPDSLink } from \"./opds2-link\";\r\nimport { OPDSMetadata } from \"./opds2-metadata\";\r\nimport { OPDSPublication } from \"./opds2-publication\";\r\n\r\n@JsonObject()\r\nexport class OPDSFeed {\r\n\r\n    @JsonProperty(\"@context\")\r\n    @JsonConverter(JsonStringConverter)\r\n    @JsonElementType(String)\r\n    public Context: string[];\r\n\r\n    @JsonProperty(\"metadata\")\r\n    public Metadata: OPDSMetadata;\r\n\r\n    @JsonProperty(\"links\")\r\n    @JsonElementType(OPDSLink)\r\n    public Links: OPDSLink[];\r\n\r\n    @JsonProperty(\"publications\")\r\n    @JsonElementType(OPDSPublication)\r\n    public Publications: OPDSPublication[];\r\n\r\n    @JsonProperty(\"navigation\")\r\n    @JsonElementType(OPDSLink)\r\n    public Navigation: OPDSLink[];\r\n\r\n    @JsonProperty(\"facets\")\r\n    @JsonElementType(OPDSFacet)\r\n    public Facets: OPDSFacet[];\r\n\r\n    @JsonProperty(\"groups\")\r\n    @JsonElementType(OPDSGroup)\r\n    public Groups: OPDSGroup[];\r\n\r\n    public findFirstLinkByRel(rel: string): OPDSLink | undefined {\r\n\r\n        return this.Links ? this.Links.find((l) => {\r\n            return l.HasRel(rel);\r\n        }) : undefined;\r\n    }\r\n\r\n    public AddLink(href: string, rel: string, typeLink: string, templated: boolean) {\r\n        const l = new OPDSLink();\r\n        l.Href = href;\r\n        l.AddRel(rel);\r\n        l.TypeLink = typeLink;\r\n        if (templated) {\r\n            l.Templated = true;\r\n        }\r\n        if (!this.Links) {\r\n            this.Links = [];\r\n        }\r\n        this.Links.push(l);\r\n    }\r\n\r\n    public AddNavigation(title: string, href: string, rel: string, typeLink: string) {\r\n        const l = new OPDSLink();\r\n        l.Href = href;\r\n        l.TypeLink = typeLink;\r\n        l.AddRel(rel);\r\n        if (title) {\r\n            l.Title = title;\r\n        }\r\n        if (!this.Navigation) {\r\n            this.Navigation = [];\r\n        }\r\n        this.Navigation.push(l);\r\n    }\r\n\r\n    public AddPagination(\r\n        numberItems: number, itemsPerPage: number, currentPage: number,\r\n        nextLink: string, prevLink: string,\r\n        firstLink: string, lastLink: string) {\r\n\r\n        if (!this.Metadata) {\r\n            this.Metadata = new OPDSMetadata();\r\n        }\r\n        this.Metadata.CurrentPage = currentPage;\r\n        this.Metadata.ItemsPerPage = itemsPerPage;\r\n        this.Metadata.NumberOfItems = numberItems;\r\n\r\n        if (nextLink) {\r\n            this.AddLink(nextLink, \"next\", \"application/opds+json\", false);\r\n        }\r\n        if (prevLink) {\r\n            this.AddLink(prevLink, \"previous\", \"application/opds+json\", false);\r\n        }\r\n        if (firstLink) {\r\n            this.AddLink(firstLink, \"first\", \"application/opds+json\", false);\r\n        }\r\n        if (lastLink) {\r\n            this.AddLink(lastLink, \"last\", \"application/opds+json\", false);\r\n        }\r\n    }\r\n\r\n    public AddFacet(link: OPDSLink, group: string) {\r\n\r\n        if (this.Facets) {\r\n            const found = this.Facets.find((f) => {\r\n                if (f.Metadata && f.Metadata.Title === group) {\r\n                    if (!f.Links) {\r\n                        f.Links = [];\r\n                    }\r\n                    f.Links.push(link);\r\n                    return true;\r\n                }\r\n                return false;\r\n            });\r\n            if (found) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        const facet = new OPDSFacet();\r\n\r\n        facet.Metadata = new OPDSMetadata();\r\n        facet.Metadata.Title = group;\r\n\r\n        facet.Links = [];\r\n        facet.Links.push(link);\r\n\r\n        if (!this.Facets) {\r\n            this.Facets = [];\r\n        }\r\n        this.Facets.push(facet);\r\n    }\r\n\r\n    public AddPublicationInGroup(publication: OPDSPublication, collLink: OPDSLink) {\r\n\r\n        if (this.Groups) {\r\n            const found1 = this.Groups.find((g) => {\r\n                if (g.Links) {\r\n                    const found2 = g.Links.find((l) => {\r\n\r\n                        if (l.Href === collLink.Href) {\r\n                            if (!g.Publications) {\r\n                                g.Publications = [];\r\n                            }\r\n                            g.Publications.push(publication);\r\n                            return true;\r\n                        }\r\n                        return false;\r\n                    });\r\n                    if (found2) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            });\r\n\r\n            if (found1) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        const group = new OPDSGroup();\r\n        group.Metadata = new OPDSMetadata();\r\n        group.Metadata.Title = collLink.Title;\r\n\r\n        group.Publications = [];\r\n        group.Publications.push(publication);\r\n\r\n        const linkSelf = new OPDSLink();\r\n        linkSelf.AddRel(\"self\");\r\n        linkSelf.Title = collLink.Title;\r\n        linkSelf.Href = collLink.Href;\r\n\r\n        group.Links = [];\r\n        group.Links.push(linkSelf);\r\n\r\n        if (!this.Groups) {\r\n            this.Groups = [];\r\n        }\r\n        this.Groups.push(group);\r\n    }\r\n\r\n    public AddNavigationInGroup(link: OPDSLink, collLink: OPDSLink) {\r\n\r\n        if (this.Groups) {\r\n            const found1 = this.Groups.find((g) => {\r\n                if (g.Links) {\r\n                    const found2 = g.Links.find((l) => {\r\n\r\n                        if (l.Href === collLink.Href) {\r\n                            if (!g.Navigation) {\r\n                                g.Navigation = [];\r\n                            }\r\n                            g.Navigation.push(link);\r\n                            return true;\r\n                        }\r\n                        return false;\r\n                    });\r\n                    if (found2) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            });\r\n\r\n            if (found1) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        const group = new OPDSGroup();\r\n        group.Metadata = new OPDSMetadata();\r\n        group.Metadata.Title = collLink.Title;\r\n\r\n        group.Navigation = [];\r\n        group.Navigation.push(link);\r\n\r\n        const linkSelf = new OPDSLink();\r\n        linkSelf.AddRel(\"self\");\r\n        linkSelf.Title = collLink.Title;\r\n        linkSelf.Href = collLink.Href;\r\n\r\n        group.Links = [];\r\n        group.Links.push(link);\r\n\r\n        if (!this.Groups) {\r\n            this.Groups = [];\r\n        }\r\n        this.Groups.push(group);\r\n    }\r\n\r\n    @OnDeserialized()\r\n    // tslint:disable-next-line:no-unused-variable\r\n    // @ts-ignore: TS6133 (is declared but its value is never read.)\r\n    private _OnDeserialized() {\r\n        if (!this.Metadata) {\r\n            console.log(\"OPDS2Feed.Metadata is not set!\");\r\n        }\r\n        if (!this.Links) {\r\n            console.log(\"OPDS2Feed.Links is not set!\");\r\n        }\r\n    }\r\n}\r\n"]}