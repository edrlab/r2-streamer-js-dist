{"version":3,"file":"preload.js","sourceRoot":"","sources":["../../../../../src/electron/renderer/preload.ts"],"names":[],"mappings":"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","sourcesContent":["import debounce = require(\"debounce\");\nimport ResizeSensor = require(\"resize-sensor/ResizeSensor\");\n\nimport { ipcRenderer } from \"electron\";\nimport { animateProperty } from \"./animateProperty\";\nimport { easings } from \"./easings\";\nimport { getURLQueryParams } from \"./querystring\";\n\nimport {\n    R2_EVENT_LINK,\n    R2_EVENT_PAGE_TURN,\n    R2_EVENT_PAGE_TURN_RES,\n    R2_EVENT_READING_LOCATION,\n    R2_EVENT_READIUMCSS,\n    R2_EVENT_WEBVIEW_READY,\n} from \"../common/events\";\n\nimport { fullQualifiedSelector } from \"./cssselector\";\n\nconst win = (global as any).window as Window;\n\nconst urlRootReadiumCSS = win.location.origin + \"/readium-css/iOS/\";\n// const urlResizeSensor = win.location.origin + \"/resize-sensor.js\";\n\nconst DEBUG_VISUALS = false;\n\nconst queryParams = win.location.search ? getURLQueryParams(win.location.search) : undefined;\n\n// console.log(\"-----\");\n// console.log(win.location.href);\n// console.log(win.location.origin);\n// console.log(win.location.pathname);\n// console.log(win.location.search);\n// console.log(win.location.hash);\n\nlet _hashElement: Element | null;\n\nconst ensureHead = () => {\n    const docElement = win.document.documentElement;\n\n    if (!win.document.head) {\n        const headElement = win.document.createElement(\"head\");\n        if (win.document.body) {\n            docElement.insertBefore(headElement, win.document.body);\n        } else {\n            docElement.appendChild(headElement);\n        }\n    }\n};\n\nipcRenderer.on(R2_EVENT_READIUMCSS, (_event: any, messageString: any) => {\n    const messageJson = JSON.parse(messageString);\n    readiumCSS(messageJson);\n});\n\nipcRenderer.on(R2_EVENT_PAGE_TURN, (_event: any, messageString: any) => {\n    const element = win.document.body;\n    if (!element) {\n        return;\n    }\n    // console.log(\"---\");\n    // console.log(\"webview.innerWidth: \" + win.innerWidth);\n    // console.log(\"document.offsetWidth: \" + win.document.documentElement.offsetWidth);\n    // console.log(\"document.clientWidth: \" + win.document.documentElement.clientWidth);\n    // console.log(\"document.scrollWidth: \" + win.document.documentElement.scrollWidth);\n    // console.log(\"document.scrollLeft: \" + win.document.documentElement.scrollLeft);\n    // console.log(\"body.offsetWidth: \" + element.offsetWidth);\n    // console.log(\"body.clientWidth: \" + element.clientWidth);\n    // console.log(\"body.scrollWidth: \" + element.scrollWidth);\n    // console.log(\"body.scrollLeft: \" + element.scrollLeft);\n    // console.log(\"---\");\n    // console.log(\"webview.innerHeight: \" + win.innerHeight);\n    // console.log(\"document.offsetHeight: \" + win.document.documentElement.offsetHeight);\n    // console.log(\"document.clientHeight: \" + win.document.documentElement.clientHeight);\n    // console.log(\"document.scrollHeight: \" + win.document.documentElement.scrollHeight);\n    // console.log(\"document.scrollTop: \" + win.document.documentElement.scrollTop);\n    // console.log(\"body.offsetHeight: \" + element.offsetHeight);\n    // console.log(\"body.clientHeight: \" + element.clientHeight);\n    // console.log(\"body.scrollHeight: \" + element.scrollHeight);\n    // console.log(\"body.scrollTop: \" + element.scrollTop);\n    // console.log(\"---\");\n\n    // win.document.body.offsetWidth === single column width (takes into account column gap?)\n    // win.document.body.clientWidth === same\n    // win.document.body.scrollWidth === full document width (all columns)\n    //\n    // win.document.body.offsetHeight === full document height (sum of all columns minus trailing blank space?)\n    // win.document.body.clientHeight === same\n    // win.document.body.scrollHeight === visible viewport height\n    //\n    // win.document.body.scrollLeft === positive number for horizontal shift\n    // win.document.body.scrollTop === positive number for vertical shift\n\n    const maxHeightShift = element.scrollHeight - win.document.documentElement.clientHeight;\n\n    const messageJson = JSON.parse(messageString);\n    // const isRTL = messageJson.direction === \"RTL\"; //  any other value is LTR\n    const goPREVIOUS = messageJson.go === \"PREVIOUS\"; // any other value is NEXT\n\n    // console.log(JSON.stringify(messageJson, null, \"  \"));\n\n    if (!goPREVIOUS) { // goPREVIOUS && isRTL || !goPREVIOUS && !isRTL) { // right\n        if (element.scrollTop < maxHeightShift) { // not at bottom\n            animateProperty(\n                win.cancelAnimationFrame,\n                undefined,\n                // (cancelled: boolean) => {\n                //     console.log(cancelled);\n                // },\n                \"scrollTop\",\n                300,\n                element,\n                element.scrollTop + win.document.documentElement.clientHeight,\n                win.requestAnimationFrame,\n                easings.easeInOutQuad,\n            );\n            // element.scrollTop += win.document.documentElement.clientHeight;\n            return;\n        }\n    } else if (goPREVIOUS) { //  && !isRTL || !goPREVIOUS && isRTL) { // left\n        if (element.scrollTop > 0) { // not at top\n            animateProperty(\n                win.cancelAnimationFrame,\n                undefined,\n                // (cancelled: boolean) => {\n                //     console.log(cancelled);\n                // },\n                \"scrollTop\",\n                300,\n                element,\n                element.scrollTop - win.document.documentElement.clientHeight,\n                win.requestAnimationFrame,\n                easings.easeInOutQuad,\n            );\n            // element.scrollTop -= win.document.documentElement.clientHeight;\n            return;\n        }\n    }\n\n    ipcRenderer.sendToHost(R2_EVENT_PAGE_TURN_RES, messageString);\n});\n\nconst readiumCSS = (messageJson: any) => {\n\n    const docElement = win.document.documentElement;\n\n    if (typeof messageJson.injectCSS !== \"undefined\") {\n        ensureHead();\n\n        const remove = (typeof messageJson.injectCSS === \"string\" && messageJson.injectCSS.indexOf(\"rollback\") >= 0)\n            || !messageJson.injectCSS;\n        if (remove) {\n            docElement.removeAttribute(\"data-readiumcss\");\n            removeAllCSS();\n            removeAllCSSInline();\n        } else if (!docElement.hasAttribute(\"data-readiumcss\")) {\n            docElement.setAttribute(\"data-readiumcss\", \"yes\");\n\n            let needsDefaultCSS = true;\n            if (win.document.head && win.document.head.childElementCount) {\n                let elem = win.document.head.firstElementChild;\n                while (elem) {\n                    if ((elem.localName && elem.localName.toLowerCase() === \"style\") ||\n                        (elem.getAttribute &&\n                            (elem.getAttribute(\"rel\") === \"stylesheet\" ||\n                                elem.getAttribute(\"type\") === \"text/css\" ||\n                                (elem.getAttribute(\"src\") &&\n                                    (elem.getAttribute(\"src\") as string).endsWith(\".css\"))))) {\n                        needsDefaultCSS = false;\n                        break;\n                    }\n                    elem = elem.nextElementSibling;\n                }\n            }\n            if (needsDefaultCSS && win.document.body) {\n                const styleAttr = win.document.body.querySelector(\"*[style]\");\n                if (styleAttr) {\n                    needsDefaultCSS = false;\n                }\n            }\n\n            // appendCSS(\"base\");\n            // appendCSS(\"html5patch\");\n            // appendCSS(\"safeguards\");\n            // appendCSS(\"default\");\n            // appendCSS(\"highlights\");\n            // if (messageJson.injectCSS.indexOf(\"scroll\") >= 0) {\n            //     appendCSS(\"scroll\");\n            // } else {\n            //     appendCSS(\"pagination\");\n            // }\n            // if (messageJson.injectCSS.indexOf(\"night_mode\") >= 0) {\n            //     appendCSS(\"night_mode\");\n            // } else if (messageJson.injectCSS.indexOf(\"sepia_mode\") >= 0) {\n            //     appendCSS(\"pagination\");\n            // }\n            // appendCSS(\"os_a11y\");\n            // appendCSS(\"user_settings\");\n            // if (messageJson.injectCSS.indexOf(\"fs_normalize\") >= 0) {\n            //     appendCSS(\"fs_normalize\");\n            // }\n\n            appendCSS(\"before\");\n            if (needsDefaultCSS) {\n                appendCSS(\"default\");\n            }\n            appendCSS(\"after\");\n\n            appendCSSInline(\"scrollbarsAndSelection\", `\n::-webkit-scrollbar-button {\nheight: 0px !important;\nwidth: 0px !important;\n}\n\n::-webkit-scrollbar-corner {\nbackground: transparent !important;\n}\n\n/*::-webkit-scrollbar-track-piece {\nbackground-color: red;\n} */\n\n::-webkit-scrollbar {\nwidth:  14px;\nheight: 14px;\n}\n\n::-webkit-scrollbar-thumb {\nbackground: #727272;\nbackground-clip: padding-box !important;\nborder: 3px solid transparent !important;\nborder-radius: 30px;\n}\n\n::-webkit-scrollbar-thumb:hover {\nbackground: #4d4d4d;\n}\n\n::-webkit-scrollbar-track {\nbox-shadow: inset 0 0 3px rgba(40, 40, 40, 0.2);\nbackground: #dddddd;\nbox-sizing: content-box;\n}\n\n::-webkit-scrollbar-track:horizontal {\nborder-top: 1px solid silver;\n}\n::-webkit-scrollbar-track:vertical {\nborder-left: 1px solid silver;\n}\n\n.mdc-theme--dark ::-webkit-scrollbar-thumb {\nbackground: #a4a4a4;\nborder: 3px solid #545454;\n}\n\n.mdc-theme--dark ::-webkit-scrollbar-thumb:hover {\nbackground: #dedede;\n}\n\n.mdc-theme--dark ::-webkit-scrollbar-track {\nbackground: #545454;\n}\n\n.mdc-theme--dark ::-webkit-scrollbar-track:horizontal {\nborder-top: 1px solid black;\n}\n.mdc-theme--dark ::-webkit-scrollbar-track:vertical {\nborder-left: 1px solid black;\n}\n\n::selection {\nbackground-color: rgb(155, 179, 240) !important;\ncolor: black !important;\n}\n\n.mdc-theme--dark ::selection {\nbackground-color: rgb(100, 122, 177) !important;\ncolor: white !important;\n}\n*:focus {\noutline-style: solid !important;\noutline-width: 2px !important;\noutline-color: blue !important;\noutline-offset: 0px !important;\n}\n*.no-focus-outline:focus {\noutline-style: none !important;\n}\n    `);\n        }\n    }\n\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/readium/readium-css/tree/develop/prototype/iOS-implem#manage-user-settings\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/readium/readium-css/blob/develop/prototype/iOS-implem/Specific-docs/CSS12-api.md#user-settings\n    // tslint:disable-next-line:max-line-length\n    // https://github.com/readium/readium-css/blob/develop/prototype/iOS-implem/Specific-docs/CSS09-user_prefs.md#switches\n    if (typeof messageJson.setCSS !== \"undefined\") {\n\n        const remove = (typeof messageJson.setCSS === \"string\" && messageJson.setCSS.indexOf(\"rollback\") >= 0)\n            || !messageJson.setCSS;\n        if (remove) {\n\n            docElement.style.overflow = \"auto\";\n\n            const toRemove: string[] = [];\n            for (let i = 0; i < docElement.style.length; i++) {\n                const item = docElement.style.item(i);\n                if (item.indexOf(\"--USER__\") === 0) {\n                    toRemove.push(item);\n                }\n            }\n            toRemove.forEach((item) => {\n                docElement.style.removeProperty(item);\n            });\n        } else {\n            let dark = false;\n            let night = false;\n            let sepia = false;\n            let invert = false;\n            let paged = false;\n            let font: string | undefined;\n            let align: string | undefined;\n            if (typeof messageJson.setCSS === \"object\") {\n                if (messageJson.setCSS.dark) {\n                    dark = true;\n                }\n                if (messageJson.setCSS.night) {\n                    night = true;\n                }\n                if (messageJson.setCSS.sepia) {\n                    sepia = true;\n                }\n                if (messageJson.setCSS.invert) {\n                    invert = true;\n                }\n                if (messageJson.setCSS.paged) {\n                    paged = true;\n                }\n                if (typeof messageJson.setCSS.font === \"string\") {\n                    font = messageJson.setCSS.font;\n                }\n                if (typeof messageJson.setCSS.align === \"string\") {\n                    align = messageJson.setCSS.align;\n                }\n            }\n\n            if (night) {\n                // win.document.body\n                docElement.classList.add(\"mdc-theme--dark\");\n            } else {\n                // win.document.body\n                docElement.classList.remove(\"mdc-theme--dark\");\n            }\n\n            const needsAdvanced = true; // dark || invert;\n\n            // readium-advanced-on | readium-advanced-off\n            docElement.style.setProperty(\"--USER__advancedSettings\",\n                needsAdvanced ? \"readium-advanced-on\" : \"readium-advanced-off\");\n\n            // readium-darken-on | readium-darken-off\n            docElement.style.setProperty(\"--USER__darkenFilter\",\n                dark ? \"readium-darken-on\" : \"readium-darken-off\");\n\n            // readium-invert-on | readium-invert-off\n            docElement.style.setProperty(\"--USER__invertFilter\",\n                invert ? \"readium-invert-on\" : \"readium-invert-off\");\n\n            // readium-default-on | readium-sepia-on | readium-night-on\n            docElement.style.setProperty(\"--USER__appearance\",\n                sepia ? \"readium-sepia-on\" : (night ? \"readium-night-on\" : \"readium-default-on\"));\n\n            // readium-paged-on | readium-scroll-on\n            docElement.style.setProperty(\"--USER__view\",\n                paged ? \"readium-paged-on\" : \"readium-scroll-on\");\n            if (paged) {\n                docElement.style.overflow = \"hidden\";\n            }\n\n            const needsFontOverride = typeof font !== \"undefined\" && font !== \"DEFAULT\";\n            // readium-font-on | readium-font-off\n            docElement.style.setProperty(\"--USER__fontOverride\",\n                needsFontOverride ? \"readium-font-on\" : \"readium-font-off\");\n\n            // var(--RS__oldStyleTf) | var(--RS__modernTf) | var(--RS__sansTf) | var(--RS__humanistTf) | AccessibleDfa\n            docElement.style.setProperty(\"--USER__fontFamily\",\n                !needsFontOverride ? \"\" :\n                    (font === \"DYS\" ? \"AccessibleDfa\" :\n                        (font === \"OLD\" ? \"var(--RS__oldStyleTf)\" :\n                            (font === \"MODERN\" ? \"var(--RS__modernTf)\" :\n                                (font === \"SANS\" ? \"var(--RS__sansTf)\" :\n                                    (font === \"HUMAN\" ? \"var(--RS__humanistTf)\" : \"var(--RS__oldStyleTf)\")\n                                )\n                            )\n                        )\n                    ));\n\n            // left (LTR) or right (RTL) | justify\n            docElement.style.setProperty(\"--USER__textAlign\",\n                align === \"justify\" ? \"justify\" :\n                    (align === \"right\" ? \"right\" :\n                        (align === \"left\" ? \"left\" : \"left\")\n                    ));\n\n            // // auto | none\n            // docElement.style.setProperty(\"--USER__bodyHyphens\", \"auto\");\n\n            // // 1 | 2 | auto\n            // docElement.style.setProperty(\"--USER__colCount\", \"2\");\n\n            // // 75% | 87.5% | 100% | 112.5% | 137.5% | 150% | 162.5% | 175% | 200% | 225% | 250%\n            // docElement.style.setProperty(\"--USER__fontSize\", \"112.5%\");\n\n            // // 1 | 1.067 | 1.125 | 1.2 (suggested default) | 1.25 | 1.333 | 1.414 | 1.5 | 1.618\n            // docElement.style.setProperty(\"--USER__typeScale\", \"1.2\");\n\n            // // 1 | 1.125 | 1.25 | 1.35 | 1.5 | 1.65 | 1.75 | 2\n            // docElement.style.setProperty(\"--USER__lineHeight\", \"2\");\n\n            // // 0 | 0.375rem | 0.75rem | 1rem | 1.125rem | 1.25rem | 1.35rem | 1.5rem | 1.65rem | 1.75rem | 2rem\n            // docElement.style.setProperty(\"--USER__paraSpacing\", \"1rem\");\n\n            // // 0 | 0.5rem | 1rem | 1.25rem | 1.5rem | 2rem | 2.5rem | 3rem\n            // docElement.style.setProperty(\"--USER__paraIndent\", \"1rem\");\n\n            // // 0.125rem | 0.25rem | 0.375rem | 0.5rem\n            // docElement.style.setProperty(\"--USER__wordSpacing\", \"0.5rem\");\n\n            // // 0.0675rem | 0.125rem | 0.1875rem | 0.25rem\n            // docElement.style.setProperty(\"--USER__letterSpacing\", \"0.1875rem\");\n\n            // // 0.5 | 0.75 | 1 | 1.25 | 1.5 | 1.75 | 2\n            // docElement.style.setProperty(\"--USER__pageMargins\", \"1.25\");\n\n            // docElement.style.setProperty(\"--USER__backgroundColor\", \"#FFFFFF\");\n            // docElement.style.setProperty(\"--USER__textColor\", \"#000000\");\n        }\n    }\n};\n\nconst checkReadyPass = () => {\n    if (_readyPassDone) {\n        return;\n    }\n    _readyPassDone = true;\n\n    if (DEBUG_VISUALS) {\n        if (_hashElement) {\n            _hashElement.classList.add(\"readium2-read-pos\");\n        }\n    }\n\n    win.addEventListener(\"resize\", () => {\n        scrollToHash();\n    });\n\n    // const docElement = win.document.documentElement;\n    // let skipFirstResize = docElement.getAttribute(\"data-readiumcss\") || false;\n    // let skipFirstScroll = skipFirstResize;\n\n    setTimeout(() => {\n        scrollToHashRaw(true);\n\n        win.addEventListener(\"scroll\", (_ev: Event) => {\n\n            if (_ignoreScrollEvent) {\n                _ignoreScrollEvent = false;\n                return;\n            }\n            // if (skipFirstScroll) {\n            //     skipFirstScroll = false;\n            //     return;\n            // }\n\n            processXY(0, 0);\n        });\n\n    }, 800);\n\n    const useResizeSensor = true;\n    if (useResizeSensor && win.document.body) {\n\n        setTimeout(() => {\n            window.requestAnimationFrame((_timestamp) => {\n                // new (win as any).\n                // tslint:disable-next-line:no-unused-expression\n                new ResizeSensor(win.document.body, () => {\n\n                    console.log(\"ResizeSensor\");\n\n                    scrollToHash();\n\n                    // if (skipFirstResize) {\n                    //     console.log(\"ResizeSensor SKIP FIRST\");\n\n                    //     skipFirstResize = false;\n                    //     return;\n                    // } else {\n                    //     console.log(\"ResizeSensor\");\n                    // }\n                });\n            });\n        }, 2000);\n    }\n\n    if (win.document.body) {\n\n        win.document.body.addEventListener(\"click\", (ev: MouseEvent) => {\n\n            const x = ev.clientX; // win.document.body.scrollLeft;\n            const y = ev.clientY; // win.document.body.scrollTop;\n\n            processXY(x, y);\n        });\n    }\n};\n\nconst notifyReady = () => {\n    if (_readyEventSent) {\n        return;\n    }\n    _readyEventSent = true;\n\n    ipcRenderer.sendToHost(R2_EVENT_WEBVIEW_READY, win.location.href);\n};\n\nconst scrollToHashRaw = (firstCall: boolean) => {\n\n    console.log(\"scrollToHash: \" + firstCall);\n\n    if (_locationHashOverride) {\n\n        console.log(\"_locationHashOverride\");\n\n        if (_locationHashOverride === win.document.body) {\n            console.log(\"body...\");\n\n            return;\n        }\n\n        notifyReady();\n        notifyReadingLocation();\n\n        _ignoreScrollEvent = true;\n        _locationHashOverride.scrollIntoView({\n            behavior: \"instant\",\n            block: \"start\",\n            inline: \"nearest\",\n        });\n\n        return;\n    } else if (_hashElement) {\n\n        console.log(\"_hashElement\");\n\n        _locationHashOverride = _hashElement;\n        // _locationHashOverrideCSSselector = fullQualifiedSelector(_locationHashOverride, false);\n\n        notifyReady();\n        notifyReadingLocation();\n\n        if (!firstCall) {\n            _ignoreScrollEvent = true;\n            _hashElement.scrollIntoView({\n                behavior: \"instant\",\n                block: \"start\",\n                inline: \"nearest\",\n            });\n        }\n\n        return;\n    } else {\n        if (win.document.body) {\n\n            if (queryParams) {\n                // tslint:disable-next-line:no-string-literal\n                const previous = queryParams[\"readiumprevious\"];\n                const isPreviousNavDirection = previous === \"true\";\n                if (isPreviousNavDirection) {\n\n                    console.log(\"_hashElement\");\n\n                    const maxHeightShift = win.document.body.scrollHeight - win.document.documentElement.clientHeight;\n\n                    _ignoreScrollEvent = true;\n                    win.document.body.scrollLeft = 0;\n                    win.document.body.scrollTop = maxHeightShift;\n\n                    _locationHashOverride = undefined;\n                    _locationHashOverrideCSSselector = undefined;\n\n                    notifyReady();\n                    notifyReadingLocation();\n                    return;\n                }\n\n                // tslint:disable-next-line:no-string-literal\n                let gotoCssSelector = queryParams[\"readiumgoto\"];\n                if (gotoCssSelector) {\n                    gotoCssSelector = gotoCssSelector.replace(/\\+/g, \" \");\n                    // console.log(\"GOTO: \" + gotoCssSelector);\n                    let selected: Element | null = null;\n                    try {\n                        selected = document.querySelector(gotoCssSelector);\n                    } catch (err) {\n                        console.log(err);\n                    }\n                    if (selected) {\n\n                        console.log(\"readiumgoto\");\n\n                        _locationHashOverride = selected;\n                        _locationHashOverrideCSSselector = gotoCssSelector;\n\n                        notifyReady();\n                        notifyReadingLocation();\n\n                        _ignoreScrollEvent = true;\n                        selected.scrollIntoView({\n                            behavior: \"instant\",\n                            block: \"start\",\n                            inline: \"nearest\",\n                        });\n\n                        return;\n                    }\n                }\n            }\n\n            console.log(\"_locationHashOverride = win.document.body\");\n\n            _locationHashOverride = win.document.body;\n            _locationHashOverrideCSSselector = undefined;\n\n            _ignoreScrollEvent = true;\n            win.document.body.scrollLeft = 0;\n            win.document.body.scrollTop = 0;\n        }\n    }\n\n    notifyReady();\n    notifyReadingLocation();\n};\n\nconst scrollToHash = debounce(() => {\n    scrollToHashRaw(false);\n}, 500);\n\nconst injectReadPosCSS = () => {\n\n    if (!DEBUG_VISUALS) {\n        return;\n    }\n\n    ensureHead();\n\n    const styleElement = win.document.createElement(\"style\");\n    styleElement.setAttribute(\"id\", \"Readium2-ReadPos\");\n    styleElement.setAttribute(\"type\", \"text/css\");\n    const css = `\n:root[style*=\"readium-sepia-on\"] .readium2-read-pos,\n:root[style*=\"readium-night-on\"] .readium2-read-pos,\n.readium2-read-pos {\n    color: red !important;\n    background-color: silver !important;\n}\n:root[style*=\"readium-sepia-on\"] .readium2-read-pos2,\n:root[style*=\"readium-night-on\"] .readium2-read-pos2,\n.readium2-read-pos2 {\n    color: blue !important;\n    background-color: yellow !important;\n}\n`;\n    styleElement.appendChild(win.document.createTextNode(css));\n    win.document.head.appendChild(styleElement);\n};\n\nlet _ignoreScrollEvent = false;\n\n// const injectResizeSensor = () => {\n//     ensureHead();\n//     const scriptElement = win.document.createElement(\"script\");\n//     scriptElement.setAttribute(\"id\", \"Readium2-ResizeSensor\");\n//     scriptElement.setAttribute(\"type\", \"application/javascript\");\n//     scriptElement.setAttribute(\"src\", urlResizeSensor);\n//     scriptElement.appendChild(win.document.createTextNode(\" \"));\n//     win.document.head.appendChild(scriptElement);\n//     scriptElement.addEventListener(\"load\", () => {\n//         console.log(\"ResizeSensor LOADED\");\n//     });\n// };\n\nlet _locationHashOverride: Element | undefined;\nlet _locationHashOverrideCSSselector: string | undefined;\nlet _readyPassDone = false;\nlet _readyEventSent = false;\n\nconst resetInitialState = () => {\n    _locationHashOverride = undefined;\n    _readyPassDone = false;\n    _readyEventSent = false;\n};\n\n// after DOMContentLoaded\nwin.addEventListener(\"load\", () => {\n    // console.log(\"PRELOAD WIN LOAD\");\n    checkReadyPass();\n});\n\n// // does not occur when re-using same webview (src=\"href\")\n// win.addEventListener(\"unload\", () => {\n//     console.log(\"PRELOAD WIN UNLOAD\");\n//     resetInitialState();\n// });\n\nwin.addEventListener(\"DOMContentLoaded\", () => {\n\n    if (win.location.hash && win.location.hash.length > 1) {\n        _hashElement = win.document.getElementById(win.location.hash.substr(1));\n    }\n\n    resetInitialState();\n\n    appendCSSInline(\"selectionAndFocus\", `\n::selection {\nbackground-color: rgb(155, 179, 240) !important;\ncolor: black !important;\n}\n*:focus {\noutline-style: solid !important;\noutline-width: 2px !important;\noutline-color: blue !important;\noutline-offset: 0px !important;\n}\n*.no-focus-outline:focus {\noutline-style: none !important;\n}`);\n\n    if (DEBUG_VISUALS) {\n        injectReadPosCSS();\n    }\n\n    win.document.addEventListener(\"click\", (e) => {\n        const href = (e.target as any).href;\n        if (!href) {\n            return;\n        }\n\n        // console.log(\"+++++\");\n        // console.log(href);\n\n        e.preventDefault();\n        e.stopPropagation();\n        ipcRenderer.sendToHost(R2_EVENT_LINK, href);\n        return false;\n    }, true);\n\n    // injectResizeSensor();\n\n    // const linkUri = new URI(win.location.href);\n    try {\n        if (queryParams) {\n            // tslint:disable-next-line:no-string-literal\n            const base64 = queryParams[\"readiumcss\"];\n            // if (!base64) {\n            //     console.log(\"!readiumcss BASE64 ??!\");\n            //     const token = \"readiumcss=\";\n            //     const i = win.location.search.indexOf(token);\n            //     if (i > 0) {\n            //         base64 = win.location.search.substr(i + token.length);\n            //         const j = base64.indexOf(\"&\");\n            //         if (j > 0) {\n            //             base64 = base64.substr(0, j);\n            //         }\n            //         base64 = decodeURIComponent(base64);\n            //     }\n            // }\n            if (base64) {\n                // console.log(base64);\n                const str = window.atob(base64);\n                // console.log(str);\n\n                const messageJson = JSON.parse(str);\n                // console.log(messageJson);\n\n                readiumCSS(messageJson);\n            }\n        }\n    } catch (err) {\n        console.log(err);\n    }\n});\n\nconst processXY = debounce((x: number, y: number) => {\n    console.log(\"processXY\");\n\n    // const elems = document.elementsFromPoint(x, y);\n    // // console.log(elems);\n    // let element: Element | undefined = elems && elems.length ? elems[0] : undefined;\n    let element: Element | undefined;\n\n    // if ((document as any).caretPositionFromPoint) {\n    //     console.log(\"caretPositionFromPoint\");\n    //     const range = (document as any).caretPositionFromPoint(x, y);\n    //     const node = range.offsetNode;\n    //     const offset = range.offset;\n    // } else if (document.caretRangeFromPoint) {\n    //     console.log(\"caretRangeFromPoint\");\n    // }\n\n    let textNode: Node | undefined;\n    let textNodeOffset = 0;\n\n    const range = document.caretRangeFromPoint(x, y);\n    if (range) {\n        const node = range.startContainer;\n        const offset = range.startOffset;\n\n        if (node) {\n            if (node.nodeType === Node.ELEMENT_NODE) {\n                element = node as Element;\n            } else if (node.nodeType === Node.TEXT_NODE) {\n                textNode = node;\n                textNodeOffset = offset;\n                if (node.parentNode && node.parentNode.nodeType === Node.ELEMENT_NODE) {\n                    element = node.parentNode as Element;\n                }\n            }\n        }\n    }\n\n    if (DEBUG_VISUALS) {\n        const existings = document.querySelectorAll(\".readium2-read-pos, .readium2-read-pos2\");\n        existings.forEach((existing) => {\n            existing.classList.remove(\"readium2-read-pos\");\n            existing.classList.remove(\"readium2-read-pos2\");\n        });\n    }\n    if (element) {\n        _locationHashOverride = element;\n        notifyReadingLocation();\n\n        if (DEBUG_VISUALS) {\n            element.classList.add(\"readium2-read-pos2\");\n\n            // // console.log(\"fullQualifiedSelector TRUE\");\n            // // const sel1 = fullQualifiedSelector(element, true);\n            // // console.log(sel1);\n\n            // // console.log(\"fullQualifiedSelector FALSE\");\n            // const sel2 = fullQualifiedSelector(element, false);\n            // // console.log(sel2);\n\n            // const selecteds = document.querySelectorAll(sel2);\n            // selecteds.forEach((selected) => {\n            //     selected.classList.remove(\"readium2-read-pos\");\n            //     selected.classList.add(\"readium2-read-pos2\");\n            // });\n        }\n    }\n}, 300);\n\nconst notifyReadingLocation = () => {\n    if (!_locationHashOverride) {\n        return;\n    }\n    _locationHashOverrideCSSselector = fullQualifiedSelector(_locationHashOverride, false);\n    ipcRenderer.sendToHost(R2_EVENT_READING_LOCATION, _locationHashOverrideCSSselector);\n};\n\nfunction appendCSSInline(id: string, css: string) {\n    const styleElement = win.document.createElement(\"style\");\n    styleElement.setAttribute(\"id\", \"Readium2-\" + id);\n    styleElement.setAttribute(\"type\", \"text/css\");\n    styleElement.appendChild(document.createTextNode(css));\n    win.document.head.appendChild(styleElement);\n}\n\nfunction removeCSSInline(id: string) {\n    const styleElement = win.document.getElementById(\"Readium2-\" + id);\n    if (styleElement && styleElement.parentNode) {\n        styleElement.parentNode.removeChild(styleElement);\n    }\n}\n\nfunction removeAllCSSInline() {\n    removeCSSInline(\"scrollbarsAndSelection\");\n}\n\nfunction appendCSS(mod: string) {\n    const linkElement = win.document.createElement(\"link\");\n    linkElement.setAttribute(\"id\", \"ReadiumCSS-\" + mod);\n    linkElement.setAttribute(\"rel\", \"stylesheet\");\n    linkElement.setAttribute(\"type\", \"text/css\");\n    linkElement.setAttribute(\"href\", urlRootReadiumCSS + \"ReadiumCSS-\" + mod + \".css\");\n    if (mod === \"before\" && win.document.head.childElementCount) {\n        win.document.head.insertBefore(linkElement, win.document.head.firstElementChild);\n    } else {\n        win.document.head.appendChild(linkElement);\n    }\n}\n\nfunction removeCSS(mod: string) {\n    const linkElement = win.document.getElementById(\"ReadiumCSS-\" + mod);\n    if (linkElement && linkElement.parentNode) {\n        linkElement.parentNode.removeChild(linkElement);\n    }\n}\n\nfunction removeAllCSS() {\n    removeCSS(\"before\");\n    removeCSS(\"after\");\n    removeCSS(\"base\");\n    removeCSS(\"html5patch\");\n    removeCSS(\"safeguards\");\n    removeCSS(\"default\");\n    removeCSS(\"highlights\");\n    removeCSS(\"scroll\");\n    removeCSS(\"pagination\");\n    removeCSS(\"night_mode\");\n    removeCSS(\"pagination\");\n    removeCSS(\"os_a11y\");\n    removeCSS(\"user_settings\");\n    removeCSS(\"fs_normalize\");\n}\n"]}