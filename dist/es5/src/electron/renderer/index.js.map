{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/electron/renderer/index.ts"],"names":[],"mappings":"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","sourcesContent":["import debounce = require(\"debounce\");\nimport { shell } from \"electron\";\nimport { ipcRenderer } from \"electron\";\nimport ElectronStore = require(\"electron-store\");\nimport * as path from \"path\";\nimport { JSON as TAJSON } from \"ta-json\";\n\nimport { setLcpNativePluginPath } from \"@parser/epub/lcp\";\nimport { initGlobals } from \"@r2-streamer-js/init-globals\";\nimport { IStringMap } from \"@r2-streamer-js/models/metadata-multilang\";\nimport { Publication } from \"@r2-streamer-js/models/publication\";\nimport {\n    R2_EVENT_LINK,\n    R2_EVENT_READIUMCSS,\n    R2_EVENT_TRY_LCP_PASS,\n    R2_EVENT_TRY_LCP_PASS_RES,\n    R2_EVENT_WEBVIEW_READY,\n} from \"../common/events\";\nimport { R2_SESSION_WEBVIEW } from \"../common/sessions\";\nimport { getURLQueryParams } from \"./querystring\";\nimport {\n    IRiotOptsLinkList,\n    IRiotOptsLinkListItem,\n    IRiotTagLinkList,\n    riotMountLinkList,\n} from \"./riots/linklist/index_\";\nimport {\n    IRiotOptsLinkListGroup,\n    IRiotOptsLinkListGroupItem,\n    IRiotTagLinkListGroup,\n    riotMountLinkListGroup,\n} from \"./riots/linklistgroup/index_\";\nimport {\n    IRiotOptsLinkTree,\n    IRiotOptsLinkTreeItem,\n    IRiotTagLinkTree,\n    riotMountLinkTree,\n} from \"./riots/linktree/index_\";\nimport {\n    IRiotOptsMenuSelect,\n    IRiotOptsMenuSelectItem,\n    IRiotTagMenuSelect,\n    riotMountMenuSelect,\n} from \"./riots/menuselect/index_\";\n\n// console.log(window.location);\n// console.log(document.baseURI);\n// console.log(document.URL);\n\ninitGlobals();\nsetLcpNativePluginPath(path.join(process.cwd(), \"LCP/lcp.node\"));\n\nconst queryParams = getURLQueryParams();\n\n// tslint:disable-next-line:no-string-literal\nconst publicationJsonUrl = queryParams[\"pub\"];\n\nconst pathBase64 = publicationJsonUrl.replace(/.*\\/pub\\/(.*)\\/manifest.json/, \"$1\");\n\nconst pathDecoded = window.atob(pathBase64);\n\nconst pathFileName = pathDecoded.substr(\n    pathDecoded.replace(/\\\\/g, \"/\").lastIndexOf(\"/\") + 1,\n    pathDecoded.length - 1);\n\n// tslint:disable-next-line:no-string-literal\nconst lcpHint = queryParams[\"lcpHint\"];\n\nconst defaultsStyling = {\n    dark: false,\n    font: \"DEFAULT\",\n    invert: false,\n    night: false,\n    readiumcss: false,\n    sepia: false,\n};\nconst defaults = {\n    basicLinkTitles: true,\n    styling: defaultsStyling,\n};\nconst electronStore = new ElectronStore({\n    defaults,\n    name: \"readium2-navigator\",\n});\n\n(electronStore as any).onDidChange(\"styling.night\", (newValue: any, oldValue: any) => {\n    if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n        return;\n    }\n\n    const nightSwitch = document.getElementById(\"night_switch-input\");\n    if (nightSwitch) {\n        (nightSwitch as HTMLInputElement).checked = newValue;\n    }\n\n    if (newValue) {\n        document.body.classList.add(\"mdc-theme--dark\");\n    } else {\n        document.body.classList.remove(\"mdc-theme--dark\");\n    }\n\n    readiumCssOnOff();\n});\n\nconst computeReadiumCssJsonMessage = (): string => {\n\n    const on = electronStore.get(\"styling.readiumcss\");\n    if (on) {\n        const dark = electronStore.get(\"styling.dark\");\n        const font = electronStore.get(\"styling.font\");\n        const invert = electronStore.get(\"styling.invert\");\n        const night = electronStore.get(\"styling.night\");\n        const sepia = electronStore.get(\"styling.sepia\");\n        const cssJson = {\n            dark,\n            font,\n            invert,\n            night,\n            sepia,\n        };\n        const jsonMsg = { injectCSS: \"yes\", setCSS: cssJson };\n        return JSON.stringify(jsonMsg, null, 0);\n\n    } else {\n        const jsonMsg = { injectCSS: \"rollback\", setCSS: \"rollback\" };\n        return JSON.stringify(jsonMsg, null, 0);\n    }\n};\n\nconst readiumCssOnOff = debounce(() => {\n\n    const str = computeReadiumCssJsonMessage();\n    _webviews.forEach((wv) => {\n        wv.send(R2_EVENT_READIUMCSS, str); // .getWebContents()\n    });\n}, 500);\n\n(electronStore as any).onDidChange(\"styling.readiumcss\", (newValue: any, oldValue: any) => {\n    if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n        return;\n    }\n    const readiumcssSwitch = document.getElementById(\"readiumcss_switch-input\");\n    if (readiumcssSwitch) {\n        (readiumcssSwitch as HTMLInputElement).checked = newValue;\n    }\n\n    readiumCssOnOff();\n\n    const nightSwitch = document.getElementById(\"night_switch-input\");\n    if (nightSwitch) {\n        (nightSwitch as HTMLInputElement).disabled = !newValue;\n    }\n\n    if (!newValue) {\n        electronStore.set(\"styling.night\", false);\n    }\n});\n\n(electronStore as any).onDidChange(\"basicLinkTitles\", (newValue: any, oldValue: any) => {\n    if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n        return;\n    }\n    const basicSwitch = document.getElementById(\"nav_basic_switch-input\");\n    if (basicSwitch) {\n        (basicSwitch as HTMLInputElement).checked = !newValue;\n    }\n});\n\nlet snackBar: any;\nlet drawer: any;\n\nexport function handleLink(href: string) {\n    const prefix = publicationJsonUrl.replace(\"manifest.json\", \"\");\n    if (href.startsWith(prefix)) {\n        if (drawer.open) {\n            drawer.open = false;\n            setTimeout(() => {\n                loadLink(href, href.replace(prefix, \"\"), publicationJsonUrl);\n            }, 200);\n        } else {\n            loadLink(href, href.replace(prefix, \"\"), publicationJsonUrl);\n        }\n    } else {\n        shell.openExternal(href);\n    }\n}\n\nwindow.onerror = (err) => {\n    console.log(\"Error\", err);\n};\n\nconst unhideWebView = (_id: string, forced: boolean) => {\n    const hidePanel = document.getElementById(\"reader_chrome_HIDE\");\n    if (hidePanel && hidePanel.style.display === \"none\") {\n\n        // const message = \"Already revealed.\";\n        // const data = {\n        //     actionHandler: () => {\n        //         // console.log(\"SnackBar OK\");\n        //     },\n        //     actionOnBottom: false,\n        //     actionText: \"OK\",\n        //     message,\n        //     multiline: false,\n        //     timeout: 1000,\n        // };\n        // snackBar.show(data);\n\n        return;\n    }\n    if (forced) {\n        console.log(\"unhideWebView FORCED\");\n    }\n    // console.log(\"unhideWebView ID: \" + id);\n    // if (_webviews.length) {\n    // let href = _webviews[0].getAttribute(\"src\");\n    // // console.log(\"WEBVIEW SRC: \" + href);\n    // const wc = _webviews[0].getWebContents();\n    // if (wc) {\n    //     const url = wc.getURL();\n    //     if (url) {\n    //         href = url;\n    //         // console.log(\"WEBVIEW URL: \" + href);\n    //     }\n    // }\n    // if (href === id) {\n    // console.log(\"webview unhiding...\");\n\n    if (hidePanel) {\n        hidePanel.style.display = \"none\";\n    }\n    // _webviews[0].style.opacity = \"1\";\n    // _webviews[0].style.visibility = \"visible\";\n    // _webviews[0].classList.remove(\"hidden\");\n    // }\n    // if (forced) {\n\n    //     const message = \"Slow content :(\";\n    //     const data = {\n    //         actionHandler: () => {\n    //             // console.log(\"SnackBar OK\");\n    //         },\n    //         actionOnBottom: false,\n    //         actionText: \"OK\",\n    //         message,\n    //         multiline: false,\n    //         timeout: 1000,\n    //     };\n    //     snackBar.show(data);\n    // }\n};\n\nipcRenderer.on(R2_EVENT_LINK, (_event: any, href: string) => {\n    console.log(\"R2_EVENT_LINK\");\n    console.log(href);\n    handleLink(href);\n});\n\nipcRenderer.on(R2_EVENT_TRY_LCP_PASS_RES, (_event: any, okay: boolean, msg: string, passSha256Hex: string) => {\n\n    if (!okay) {\n        setTimeout(() => {\n            showLcpDialog(msg);\n        }, 500);\n\n        return;\n    }\n\n    const lcpStore = electronStore.get(\"lcp\");\n    if (!lcpStore) {\n        const lcpObj: any = {};\n        const pubLcpObj: any = lcpObj[pathDecoded] = {};\n        pubLcpObj.sha = passSha256Hex;\n\n        electronStore.set(\"lcp\", lcpObj);\n    } else {\n        const pubLcpStore = lcpStore[pathDecoded];\n        if (pubLcpStore) {\n            pubLcpStore.sha = passSha256Hex;\n        } else {\n            lcpStore[pathDecoded] = {\n                sha: passSha256Hex,\n            };\n        }\n        electronStore.set(\"lcp\", lcpStore);\n    }\n\n    startNavigatorExperiment();\n});\n\nlet lcpDialog: any;\n\nfunction showLcpDialog(message?: string) {\n\n    // dialog.lastFocusedTarget = evt.target;\n\n    const lcpPassHint = document.getElementById(\"lcpPassHint\");\n    (lcpPassHint as HTMLInputElement).textContent = lcpHint;\n\n    if (message) {\n        const lcpPassMessage = document.getElementById(\"lcpPassMessage\");\n        (lcpPassMessage as HTMLInputElement).textContent = message;\n    }\n\n    lcpDialog.show();\n    setTimeout(() => {\n        const lcpPassInput = document.getElementById(\"lcpPassInput\");\n        if (lcpPassInput) {\n            lcpPassInput.focus();\n            setTimeout(() => {\n                lcpPassInput.classList.add(\"no-focus-outline\");\n            }, 500);\n        }\n    }, 800);\n}\n\nfunction installKeyboardMouseFocusHandler() {\n    let dateLastKeyboardEvent = new Date();\n    let dateLastMouseEvent = new Date();\n    document.body.addEventListener(\"focusin\", debounce((ev: any) => {\n        const focusWasTriggeredByMouse = dateLastMouseEvent > dateLastKeyboardEvent;\n        if (focusWasTriggeredByMouse) {\n            if (ev.target && ev.target.classList) {\n                ev.target.classList.add(\"no-focus-outline\");\n            }\n        }\n    }, 500));\n    document.body.addEventListener(\"focusout\", (ev: any) => {\n        if (ev.target && ev.target.classList) {\n            ev.target.classList.remove(\"no-focus-outline\");\n        }\n    });\n    document.body.addEventListener(\"mousedown\", () => {\n        dateLastMouseEvent = new Date();\n    });\n    document.body.addEventListener(\"keydown\", () => {\n        dateLastKeyboardEvent = new Date();\n    });\n}\n\nconst initFontSelector = () => {\n\n    const options: IRiotOptsMenuSelectItem[] =\n        [{\n            id: \"DEFAULT\",\n            label: \"Default\",\n        }, {\n            id: \"OLD\",\n            label: \"Old Style\",\n        }, {\n            id: \"MODERN\",\n            label: \"Modern\",\n        }, {\n            id: \"SANS\",\n            label: \"Sans\",\n        }, {\n            id: \"HUMAN\",\n            label: \"Humanist\",\n        }, {\n            id: \"DYS\",\n            label: \"Readable (dys)\",\n        }];\n    const opts: IRiotOptsMenuSelect = {\n        disabled: !electronStore.get(\"styling.readiumcss\"),\n        options,\n        selected: electronStore.get(\"styling.font\"),\n    };\n    const tag = riotMountMenuSelect(\"#fontSelect\", opts)[0] as IRiotTagMenuSelect;\n\n    tag.on(\"selectionChanged\", (val: string) => {\n        electronStore.set(\"styling.font\", val);\n    });\n\n    (electronStore as any).onDidChange(\"styling.font\", (newValue: any, oldValue: any) => {\n        if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n            return;\n        }\n        tag.setSelectedItem(newValue);\n\n        readiumCssOnOff();\n    });\n\n    (electronStore as any).onDidChange(\"styling.readiumcss\", (newValue: any, oldValue: any) => {\n        if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n            return;\n        }\n        tag.setDisabled(!newValue);\n    });\n};\n\nwindow.addEventListener(\"DOMContentLoaded\", () => {\n\n    setTimeout(() => {\n        // material-components-web\n        (window as any).mdc.autoInit();\n    }, 500);\n\n    window.document.title = \"Readium2 [ \" + pathFileName + \"]\";\n\n    const h1 = document.getElementById(\"pubTitle\");\n    if (h1) {\n        (h1 as HTMLElement).textContent = pathFileName;\n    }\n\n    installKeyboardMouseFocusHandler();\n\n    if (electronStore.get(\"styling.night\")) {\n        document.body.classList.add(\"mdc-theme--dark\");\n    } else {\n        document.body.classList.remove(\"mdc-theme--dark\");\n    }\n\n    initFontSelector();\n\n    const snackBarElem = document.getElementById(\"snackbar\");\n    snackBar = new (window as any).mdc.snackbar.MDCSnackbar(snackBarElem);\n    (snackBarElem as any).mdcSnackbar = snackBar;\n    snackBar.dismissesOnAction = true;\n\n    const drawerElement = document.getElementById(\"drawer\");\n    drawer = new (window as any).mdc.drawer.MDCTemporaryDrawer(drawerElement);\n    (drawerElement as any).mdcTemporaryDrawer = drawer;\n    const drawerButton = document.getElementById(\"drawerButton\");\n    if (drawerButton) {\n        drawerButton.addEventListener(\"click\", () => {\n            drawer.open = true;\n        });\n    }\n    if (drawerElement) {\n        drawerElement.addEventListener(\"click\", (ev) => {\n            const allMenus = drawerElement.querySelectorAll(\".mdc-simple-menu\");\n            const openedMenus: Node[] = [];\n            allMenus.forEach((elem) => {\n                if ((elem as any).mdcSimpleMenu && (elem as any).mdcSimpleMenu.open) {\n                    openedMenus.push(elem);\n                }\n            });\n\n            let needsToCloseMenus = true;\n            let currElem: Node | null = ev.target as Node;\n            while (currElem) {\n                if (openedMenus.indexOf(currElem) >= 0) {\n                    needsToCloseMenus = false;\n                    break;\n                }\n                currElem = currElem.parentNode;\n            }\n            if (needsToCloseMenus) {\n                openedMenus.forEach((elem) => {\n                    (elem as any).mdcSimpleMenu.open = false;\n                    const ss = (elem.parentNode as HTMLElement).querySelector(\".mdc-select__selected-text\");\n                    if (ss) {\n                        (ss as HTMLElement).style.transform = \"initial\";\n                        (ss as HTMLElement).style.opacity = \"1\";\n                        (ss as HTMLElement).focus();\n                    }\n                });\n            } else {\n                // console.log(\"NOT CLOSING MENU\");\n            }\n        }, true);\n    }\n    // if (drawerElement) {\n    //     drawerElement.addEventListener(\"MDCTemporaryDrawer:open\", () => {\n    //         console.log(\"MDCTemporaryDrawer:open\");\n    //     });\n    //     drawerElement.addEventListener(\"MDCTemporaryDrawer:close\", () => {\n    //         console.log(\"MDCTemporaryDrawer:close\");\n    //     });\n    // }\n\n    const menuFactory = (menuEl: HTMLElement) => {\n        const menu = new (window as any).mdc.menu.MDCSimpleMenu(menuEl);\n        (menuEl as any).mdcSimpleMenu = menu;\n        return menu;\n    };\n\n    const selectElement = document.getElementById(\"nav-select\");\n    const navSelector = new (window as any).mdc.select.MDCSelect(selectElement, undefined, menuFactory);\n    (selectElement as any).mdcSelect = navSelector;\n    navSelector.listen(\"MDCSelect:change\", (ev: any) => {\n        // console.log(\"MDCSelect:change\");\n        // console.log(ev);\n        // console.log(ev.detail.selectedOptions[0].textContent);\n        // console.log(ev.detail.selectedIndex);\n        // console.log(ev.detail.value);\n\n        const activePanel = document.querySelector(\".tabPanel.active\");\n        if (activePanel) {\n            activePanel.classList.remove(\"active\");\n        }\n        const newActivePanel = document.querySelector(\".tabPanel:nth-child(\" + (ev.detail.selectedIndex + 1) + \")\");\n        if (newActivePanel) {\n            newActivePanel.classList.add(\"active\");\n        }\n    });\n\n    const diagElem = document.querySelector(\"#lcpDialog\");\n    const lcpPassInput = document.getElementById(\"lcpPassInput\");\n    lcpDialog = new (window as any).mdc.dialog.MDCDialog(diagElem);\n    (diagElem as any).mdcDialog = lcpDialog;\n    lcpDialog.listen(\"MDCDialog:accept\", () => {\n\n        const lcpPass = (lcpPassInput as HTMLInputElement).value;\n\n        ipcRenderer.send(R2_EVENT_TRY_LCP_PASS, pathDecoded, lcpPass, false);\n    });\n    lcpDialog.listen(\"MDCDialog:cancel\", () => {\n\n        setTimeout(() => {\n            showLcpDialog();\n        }, 10);\n    });\n    if (lcpPassInput) {\n        lcpPassInput.addEventListener(\"keyup\", (ev) => {\n            if (ev.keyCode === 13) {\n                ev.preventDefault();\n                const lcpDialogAcceptButton = document.getElementById(\"lcpDialogAcceptButton\");\n                if (lcpDialogAcceptButton) {\n                    lcpDialogAcceptButton.click();\n                }\n            }\n        });\n    }\n\n    if (lcpHint) {\n\n        let lcpPassSha256Hex: string | undefined;\n        const lcpStore = electronStore.get(\"lcp\");\n        if (lcpStore) {\n            const pubLcpStore = lcpStore[pathDecoded];\n            if (pubLcpStore && pubLcpStore.sha) {\n                lcpPassSha256Hex = pubLcpStore.sha;\n            }\n        }\n        if (lcpPassSha256Hex) {\n            ipcRenderer.send(R2_EVENT_TRY_LCP_PASS, pathDecoded, lcpPassSha256Hex, true);\n        } else {\n            showLcpDialog();\n        }\n    } else {\n        startNavigatorExperiment();\n    }\n\n    const buttonClearSettings = document.getElementById(\"buttonClearSettings\");\n    if (buttonClearSettings) {\n        buttonClearSettings.addEventListener(\"click\", () => {\n            // electronStore.clear();\n            electronStore.store = defaults;\n\n            drawer.open = false;\n            setTimeout(() => {\n                const message = \"Settings reset.\";\n                const data = {\n                    actionHandler: () => {\n                        // console.log(\"SnackBar OK\");\n                    },\n                    actionOnBottom: false,\n                    actionText: \"OK\",\n                    message,\n                    multiline: false,\n                    timeout: 2000,\n                };\n                snackBar.show(data);\n            }, 500);\n        });\n    }\n\n    const buttonClearSettingsStyle = document.getElementById(\"buttonClearSettingsStyle\");\n    if (buttonClearSettingsStyle) {\n        buttonClearSettingsStyle.addEventListener(\"click\", () => {\n\n            electronStore.set(\"styling\", defaultsStyling);\n\n            drawer.open = false;\n            setTimeout(() => {\n                const message = \"Default styles.\";\n                const data = {\n                    actionHandler: () => {\n                        // console.log(\"SnackBar OK\");\n                    },\n                    actionOnBottom: false,\n                    actionText: \"OK\",\n                    message,\n                    multiline: false,\n                    timeout: 2000,\n                };\n                snackBar.show(data);\n            }, 500);\n        });\n    }\n\n    const buttonOpenSettings = document.getElementById(\"buttonOpenSettings\");\n    if (buttonOpenSettings) {\n        buttonOpenSettings.addEventListener(\"click\", () => {\n            electronStore.openInEditor();\n        });\n    }\n\n    const buttonDebug = document.getElementById(\"buttonDebug\");\n    if (buttonDebug) {\n        buttonDebug.addEventListener(\"click\", () => {\n            if (document.documentElement.classList.contains(\"debug\")) {\n                document.documentElement.classList.remove(\"debug\");\n            } else {\n                document.documentElement.classList.add(\"debug\");\n            }\n        });\n    }\n\n    // const buttonDevTools = document.getElementById(\"buttonDevTools\");\n    // if (buttonDevTools) {\n    //     buttonDevTools.addEventListener(\"click\", () => {\n    //         ipcRenderer.send(R2_EVENT_DEVTOOLS, \"test\");\n    //     });\n    // }\n});\n\nconst _webviews: Electron.WebviewTag[] = [];\n\nfunction createWebView() {\n    const webview1 = document.createElement(\"webview\");\n    webview1.setAttribute(\"class\", \"singleFull\");\n    webview1.setAttribute(\"webpreferences\",\n        \"nodeIntegration=0, nodeIntegrationInWorker=0, sandbox=0, javascript=1, \" +\n        \"contextIsolation=0, webSecurity=1, allowRunningInsecureContent=0\");\n    webview1.setAttribute(\"partition\", R2_SESSION_WEBVIEW);\n    webview1.setAttribute(\"httpreferrer\", publicationJsonUrl);\n    webview1.setAttribute(\"preload\", \"./preload.js\");\n    webview1.setAttribute(\"disableguestresize\", \"\");\n\n    webview1.addEventListener(\"ipc-message\", (event) => {\n        if (event.channel === R2_EVENT_LINK) {\n            handleLink(event.args[0]);\n        } else if (event.channel === R2_EVENT_WEBVIEW_READY) {\n            const id = event.args[0];\n            unhideWebView(id, false);\n        } else {\n            console.log(\"webview1 ipc-message\");\n            console.log(event.channel);\n        }\n    });\n\n    webview1.addEventListener(\"dom-ready\", () => {\n        // webview1.openDevTools();\n\n        webview1.clearHistory();\n\n        // ReadiumCSS config passed into load URL\n        // no need to do this in DOM-ready\n        // readiumCssOnOff();\n\n        // webview1.getWebContents().on(\"will-navigate\", (evt, url) => {\n        //     console.log(\"webview1.getWebContents().on('will-navigate'\");\n        //     console.log(evt);\n        //     console.log(url);\n        //     evt.preventDefault();\n        //     // webview1.stop();\n        //     shell.openExternal(url);\n        // });\n    });\n\n    // webview1.addEventListener(\"will-navigate\", (evt) => {\n    //     console.log(\"webview1.addEventListener('will-navigate'\");\n    //     console.log(evt);\n    //     console.log(evt.url);\n    //     // evt.preventDefault();\n    //     webview1.stop();\n    //     shell.openExternal(evt.url);\n    // });\n\n    return webview1;\n}\n\nwindow.addEventListener(\"resize\", debounce(() => {\n\n    _webviews.forEach((wv) => {\n\n        // webview.offsetWidth == full including borders\n        // webview.scrollWidth == webview.clientWidth == without borders\n\n        // const computedStyle = window.getComputedStyle(webview1);\n        // console.log(parseInt(computedStyle.width as string, 10));\n        // console.log(parseInt(computedStyle.height as string, 10));\n\n        const width = wv.clientWidth;\n        const height = wv.clientHeight;\n\n        const wc = wv.getWebContents();\n        if (wc && width && height) {\n            wc.setSize({\n                normal: {\n                    height,\n                    width,\n                },\n            });\n        }\n    });\n}, 200));\n\nfunction loadLink(hrefFull: string, _hrefPartial: string, _publicationJsonUrl: string) {\n    if (_webviews.length) {\n\n        const hidePanel = document.getElementById(\"reader_chrome_HIDE\");\n        if (hidePanel) {\n            hidePanel.style.display = \"block\";\n        }\n        // _webviews[0].style.opacity = \"0.6\";\n        // _webviews[0].style.visibility = \"hidden\";\n        // _webviews[0].classList.add(\"hidden\");\n        setTimeout(() => {\n            if (_webviews.length) {\n                const href = _webviews[0].getAttribute(\"src\");\n                if (href) {\n                    unhideWebView(href, true);\n                }\n            }\n        }, 5000);\n\n        let urlWithSearch = hrefFull;\n        const urlParts = hrefFull.split(\"#\");\n        if (urlParts && (urlParts.length === 1 || urlParts.length === 2)) {\n\n            const str = computeReadiumCssJsonMessage();\n            // const str = window.atob(base64);\n            const base64 = window.btoa(str);\n\n            const alreadyHasSearch = urlParts[0].indexOf(\"?\") > 0;\n            urlWithSearch = urlParts[0] +\n                (alreadyHasSearch ? \"&\" : \"?\") +\n                \"readiumcss=\" +\n                base64 +\n                (urlParts.length === 2 ? (\"#\" + urlParts[1]) : \"\");\n        }\n\n        _webviews[0].setAttribute(\"src\", urlWithSearch);\n        // _webviews[0].getWebContents().loadURL(tocLinkHref, { extraHeaders: \"pragma: no-cache\\n\" });\n        // _webviews[0].loadURL(tocLinkHref, { extraHeaders: \"pragma: no-cache\\n\" });\n    }\n}\n\nfunction startNavigatorExperiment() {\n\n    const webviewFull = createWebView();\n    _webviews.push(webviewFull);\n\n    const publicationViewport = document.getElementById(\"publication_viewport\");\n    if (publicationViewport) {\n        publicationViewport.appendChild(webviewFull);\n    }\n\n    const nightSwitch = document.getElementById(\"night_switch-input\");\n    if (nightSwitch) {\n        (nightSwitch as HTMLInputElement).checked = electronStore.get(\"styling.night\");\n        nightSwitch.addEventListener(\"change\", (_event) => {\n            const checked = (nightSwitch as HTMLInputElement).checked;\n            electronStore.set(\"styling.night\", checked);\n        });\n        (nightSwitch as HTMLInputElement).disabled = !electronStore.get(\"styling.readiumcss\");\n    }\n\n    const readiumcssSwitch = document.getElementById(\"readiumcss_switch-input\");\n    if (readiumcssSwitch) {\n        (readiumcssSwitch as HTMLInputElement).checked = electronStore.get(\"styling.readiumcss\");\n        readiumcssSwitch.addEventListener(\"change\", (_event) => {\n            const checked = (readiumcssSwitch as HTMLInputElement).checked;\n            electronStore.set(\"styling.readiumcss\", checked);\n        });\n    }\n\n    const basicSwitch = document.getElementById(\"nav_basic_switch-input\");\n    if (basicSwitch) {\n        (basicSwitch as HTMLInputElement).checked = !electronStore.get(\"basicLinkTitles\");\n        basicSwitch.addEventListener(\"change\", (_event) => {\n            const checked = (basicSwitch as HTMLInputElement).checked;\n            electronStore.set(\"basicLinkTitles\", !checked);\n        });\n    }\n\n    // tslint:disable-next-line:no-floating-promises\n    (async () => {\n\n        let response: Response | undefined;\n        try {\n            response = await fetch(publicationJsonUrl);\n        } catch (e) {\n            console.log(e);\n        }\n        if (!response) {\n            return;\n        }\n        if (!response.ok) {\n            console.log(\"BAD RESPONSE?!\");\n        }\n        // response.headers.forEach((arg0: any, arg1: any) => {\n        //     console.log(arg0 + \" => \" + arg1);\n        // });\n\n        let pubJson: any | undefined;\n        try {\n            pubJson = await response.json();\n        } catch (e) {\n            console.log(e);\n        }\n        if (!pubJson) {\n            return;\n        }\n        // const pubJson = global.JSON.parse(publicationStr);\n\n        const publication = TAJSON.deserialize<Publication>(pubJson, Publication);\n\n        if (publication.Metadata && publication.Metadata.Title) {\n            let title: string | undefined;\n            if (typeof publication.Metadata.Title === \"string\") {\n                title = publication.Metadata.Title;\n            } else {\n                const keys = Object.keys(publication.Metadata.Title as IStringMap);\n                if (keys && keys.length) {\n                    title = (publication.Metadata.Title as IStringMap)[keys[0]];\n                }\n            }\n\n            if (title) {\n                const h1 = document.getElementById(\"pubTitle\");\n                if (h1) {\n                    (h1 as HTMLElement).textContent = title;\n                }\n            }\n        }\n\n        const buttonNavLeft = document.getElementById(\"buttonNavLeft\");\n        if (buttonNavLeft) {\n            buttonNavLeft.addEventListener(\"click\", (_event) => {\n                navLeftOrRight(false, publicationJsonUrl, publication);\n            });\n        }\n\n        const buttonNavRight = document.getElementById(\"buttonNavRight\");\n        if (buttonNavRight) {\n            buttonNavRight.addEventListener(\"click\", (_event) => {\n                navLeftOrRight(true, publicationJsonUrl, publication);\n            });\n        }\n\n        if (publication.Spine && publication.Spine.length) {\n\n            const opts: IRiotOptsLinkList = {\n                basic: true,\n                fixBasic: true, // always single-line list items (no title)\n                links: pubJson.spine as IRiotOptsLinkListItem[],\n                url: publicationJsonUrl,\n            };\n            // const tag =\n            riotMountLinkList(\"#reader_controls_SPINE\", opts);\n\n            const firstLinear = publication.Spine[0];\n            if (firstLinear) {\n                setTimeout(() => {\n                    const firstLinearLinkHref = publicationJsonUrl + \"/../\" + firstLinear.Href;\n                    handleLink(firstLinearLinkHref);\n                }, 200);\n            }\n        }\n\n        if (publication.TOC && publication.TOC.length) {\n\n            const opts: IRiotOptsLinkTree = {\n                basic: electronStore.get(\"basicLinkTitles\"),\n                links: pubJson.toc as IRiotOptsLinkTreeItem[],\n                url: publicationJsonUrl,\n            };\n            const tag = riotMountLinkTree(\"#reader_controls_TOC\", opts)[0] as IRiotTagLinkTree;\n\n            (electronStore as any).onDidChange(\"basicLinkTitles\", (newValue: any, oldValue: any) => {\n                if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n                    return;\n                }\n                tag.setBasic(newValue);\n            });\n        }\n        if (publication.PageList && publication.PageList.length) {\n\n            const opts: IRiotOptsLinkList = {\n                basic: electronStore.get(\"basicLinkTitles\"),\n                links: pubJson[\"page-list\"] as IRiotOptsLinkListItem[],\n                url: publicationJsonUrl,\n            };\n            const tag = riotMountLinkList(\"#reader_controls_PAGELIST\", opts)[0] as IRiotTagLinkList;\n\n            (electronStore as any).onDidChange(\"basicLinkTitles\", (newValue: any, oldValue: any) => {\n                if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n                    return;\n                }\n                tag.setBasic(newValue);\n            });\n        }\n\n        const landmarksData: IRiotOptsLinkListGroupItem[] = [];\n        if (publication.Landmarks && publication.Landmarks.length) {\n            landmarksData.push({\n                label: \"Main\",\n                links: pubJson.landmarks as IRiotOptsLinkListItem[],\n            });\n        }\n        if (publication.LOT && publication.LOT.length) {\n            landmarksData.push({\n                label: \"Tables\",\n                links: pubJson.lot as IRiotOptsLinkListItem[],\n            });\n        }\n        if (publication.LOI && publication.LOI.length) {\n            landmarksData.push({\n                label: \"Illustrations\",\n                links: pubJson.loi as IRiotOptsLinkListItem[],\n            });\n        }\n        if (publication.LOV && publication.LOV.length) {\n            landmarksData.push({\n                label: \"Video\",\n                links: pubJson.lov as IRiotOptsLinkListItem[],\n            });\n        }\n        if (publication.LOA && publication.LOA.length) {\n            landmarksData.push({\n                label: \"Audio\",\n                links: pubJson.loa as IRiotOptsLinkListItem[],\n            });\n        }\n        if (landmarksData.length) {\n            const opts: IRiotOptsLinkListGroup = {\n                basic: electronStore.get(\"basicLinkTitles\"),\n                linksgroup: landmarksData,\n                url: publicationJsonUrl,\n            };\n            const tag = riotMountLinkListGroup(\"#reader_controls_LANDMARKS\", opts)[0] as IRiotTagLinkListGroup;\n\n            (electronStore as any).onDidChange(\"basicLinkTitles\", (newValue: any, oldValue: any) => {\n                if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n                    return;\n                }\n                tag.setBasic(newValue);\n            });\n        }\n    })();\n}\n\nfunction navLeftOrRight(_right: boolean, _publicationJsonUrl: string, _publication: Publication) {\n    // TODO: publication spine + pagination state\n}\n"]}