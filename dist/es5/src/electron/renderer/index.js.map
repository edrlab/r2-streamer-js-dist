{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/electron/renderer/index.ts"],"names":[],"mappings":"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","sourcesContent":["import SystemFonts = require(\"system-font-families\");\n\nimport debounce = require(\"debounce\");\nimport URI = require(\"urijs\");\n\nimport { encodeURIComponent_RFC3986 } from \"@r2-streamer-js/_utils/http/UrlUtils\";\nimport { initGlobals } from \"@r2-streamer-js/init-globals\";\nimport { IStringMap } from \"@r2-streamer-js/models/metadata-multilang\";\nimport { Publication } from \"@r2-streamer-js/models/publication\";\nimport { Link } from \"@r2-streamer-js/models/publication-link\";\nimport { setLcpNativePluginPath } from \"@r2-streamer-js/parser/epub/lcp\";\nimport { shell } from \"electron\";\nimport { ipcRenderer } from \"electron\";\nimport * as path from \"path\";\nimport { JSON as TAJSON } from \"ta-json\";\nimport {\n    R2_EVENT_LCP_LSD_RENEW,\n    R2_EVENT_LCP_LSD_RENEW_RES,\n    R2_EVENT_LCP_LSD_RETURN,\n    R2_EVENT_LCP_LSD_RETURN_RES,\n    R2_EVENT_LINK,\n    R2_EVENT_PAGE_TURN,\n    R2_EVENT_PAGE_TURN_RES,\n    R2_EVENT_READING_LOCATION,\n    R2_EVENT_READIUMCSS,\n    R2_EVENT_SCROLLTO,\n    R2_EVENT_TRY_LCP_PASS,\n    R2_EVENT_TRY_LCP_PASS_RES,\n    R2_EVENT_WEBVIEW_READY,\n} from \"../common/events\";\nimport { R2_SESSION_WEBVIEW } from \"../common/sessions\";\nimport { IStore } from \"../common/store\";\nimport { StoreElectron } from \"../common/store-electron\";\nimport { getURLQueryParams } from \"./querystring\";\nimport {\n    IRiotOptsLinkList,\n    IRiotOptsLinkListItem,\n    IRiotTagLinkList,\n    riotMountLinkList,\n} from \"./riots/linklist/index_\";\nimport {\n    IRiotOptsLinkListGroup,\n    IRiotOptsLinkListGroupItem,\n    IRiotTagLinkListGroup,\n    riotMountLinkListGroup,\n} from \"./riots/linklistgroup/index_\";\nimport {\n    IRiotOptsLinkTree,\n    IRiotOptsLinkTreeItem,\n    IRiotTagLinkTree,\n    riotMountLinkTree,\n} from \"./riots/linktree/index_\";\nimport {\n    IRiotOptsMenuSelect,\n    IRiotOptsMenuSelectItem,\n    IRiotTagMenuSelect,\n    riotMountMenuSelect,\n} from \"./riots/menuselect/index_\";\n\nconst electronStore: IStore = new StoreElectron(\"readium2-navigator\", {\n    basicLinkTitles: true,\n    styling: {\n        dark: false,\n        font: \"DEFAULT\",\n        invert: false,\n        night: false,\n        readiumcss: false,\n        sepia: false,\n    },\n});\n\nconst electronStoreLCP: IStore = new StoreElectron(\"readium2-navigator-lcp\", {});\n\n// console.log(window.location);\n// console.log(document.baseURI);\n// console.log(document.URL);\n\ninitGlobals();\nsetLcpNativePluginPath(path.join(process.cwd(), \"LCP/lcp.node\"));\n\nconst queryParams = getURLQueryParams();\n\n// tslint:disable-next-line:no-string-literal\nconst publicationJsonUrl = queryParams[\"pub\"];\n\nconst pathBase64 = publicationJsonUrl.replace(/.*\\/pub\\/(.*)\\/manifest.json/, \"$1\");\n\nconst pathDecoded = window.atob(pathBase64);\n\nconst pathFileName = pathDecoded.substr(\n    pathDecoded.replace(/\\\\/g, \"/\").lastIndexOf(\"/\") + 1,\n    pathDecoded.length - 1);\n\n// tslint:disable-next-line:no-string-literal\nconst lcpHint = queryParams[\"lcpHint\"];\n\nelectronStore.onChanged(\"styling.night\", (newValue: any, oldValue: any) => {\n    if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n        return;\n    }\n\n    const nightSwitch = document.getElementById(\"night_switch-input\") as HTMLInputElement;\n    nightSwitch.checked = newValue;\n\n    if (newValue) {\n        document.body.classList.add(\"mdc-theme--dark\");\n    } else {\n        document.body.classList.remove(\"mdc-theme--dark\");\n    }\n\n    readiumCssOnOff();\n});\n\nconst computeReadiumCssJsonMessage = (): string => {\n\n    const on = electronStore.get(\"styling.readiumcss\");\n    if (on) {\n        const dark = electronStore.get(\"styling.dark\");\n        const font = electronStore.get(\"styling.font\");\n        const invert = electronStore.get(\"styling.invert\");\n        const night = electronStore.get(\"styling.night\");\n        const sepia = electronStore.get(\"styling.sepia\");\n        const cssJson = {\n            dark,\n            font,\n            invert,\n            night,\n            sepia,\n        };\n        const jsonMsg = { injectCSS: \"yes\", setCSS: cssJson };\n        return JSON.stringify(jsonMsg, null, 0);\n\n    } else {\n        const jsonMsg = { injectCSS: \"rollback\", setCSS: \"rollback\" };\n        return JSON.stringify(jsonMsg, null, 0);\n    }\n};\n\nconst readiumCssOnOff = debounce(() => {\n\n    const str = computeReadiumCssJsonMessage();\n    _webview1.send(R2_EVENT_READIUMCSS, str); // .getWebContents()\n    _webview2.send(R2_EVENT_READIUMCSS, str); // .getWebContents()\n}, 500);\n\nelectronStore.onChanged(\"styling.readiumcss\", (newValue: any, oldValue: any) => {\n    if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n        return;\n    }\n    const readiumcssSwitch = document.getElementById(\"readiumcss_switch-input\") as HTMLInputElement;\n    readiumcssSwitch.checked = newValue;\n\n    readiumCssOnOff();\n\n    const nightSwitch = document.getElementById(\"night_switch-input\") as HTMLInputElement;\n    nightSwitch.disabled = !newValue;\n\n    if (!newValue) {\n        electronStore.set(\"styling.night\", false);\n    }\n});\n\nelectronStore.onChanged(\"basicLinkTitles\", (newValue: any, oldValue: any) => {\n    if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n        return;\n    }\n    const basicSwitch = document.getElementById(\"nav_basic_switch-input\") as HTMLInputElement;\n    basicSwitch.checked = !newValue;\n});\n\nlet snackBar: any;\nlet drawer: any;\n\nwindow.onerror = (err) => {\n    console.log(\"Error\", err);\n};\n\nconst unhideWebView = (forced: boolean) => {\n    if (_viewHideInterval) {\n        clearInterval(_viewHideInterval);\n        _viewHideInterval = undefined;\n    }\n    const hidePanel = document.getElementById(\"reader_chrome_HIDE\") as HTMLElement;\n    if (hidePanel.style.display === \"none\") {\n        return;\n    }\n    if (forced) {\n        console.log(\"unhideWebView FORCED\");\n    }\n    if (hidePanel) {\n        hidePanel.style.display = \"none\";\n    }\n};\n\nipcRenderer.on(R2_EVENT_LINK, (_event: any, href: string) => {\n    console.log(\"R2_EVENT_LINK\");\n    console.log(href);\n    handleLink(href, undefined, false);\n});\n\nipcRenderer.on(R2_EVENT_TRY_LCP_PASS_RES, (_event: any, okay: boolean, msg: string, passSha256Hex: string) => {\n\n    if (!okay) {\n        setTimeout(() => {\n            showLcpDialog(msg);\n        }, 500);\n\n        return;\n    }\n\n    const lcpStore = electronStoreLCP.get(\"lcp\");\n    if (!lcpStore) {\n        const lcpObj: any = {};\n        const pubLcpObj: any = lcpObj[pathDecoded] = {};\n        pubLcpObj.sha = passSha256Hex;\n\n        electronStoreLCP.set(\"lcp\", lcpObj);\n    } else {\n        const pubLcpStore = lcpStore[pathDecoded];\n        if (pubLcpStore) {\n            pubLcpStore.sha = passSha256Hex;\n        } else {\n            lcpStore[pathDecoded] = {\n                sha: passSha256Hex,\n            };\n        }\n        electronStoreLCP.set(\"lcp\", lcpStore);\n    }\n\n    startNavigatorExperiment();\n});\n\nlet lcpDialog: any;\n\nfunction showLcpDialog(message?: string) {\n\n    // dialog.lastFocusedTarget = evt.target;\n\n    const lcpPassHint = document.getElementById(\"lcpPassHint\") as HTMLElement;\n    lcpPassHint.textContent = lcpHint;\n\n    if (message) {\n        const lcpPassMessage = document.getElementById(\"lcpPassMessage\") as HTMLElement;\n        lcpPassMessage.textContent = message;\n    }\n\n    lcpDialog.show();\n    setTimeout(() => {\n        const lcpPassInput = document.getElementById(\"lcpPassInput\") as HTMLElement;\n        lcpPassInput.focus();\n        setTimeout(() => {\n            lcpPassInput.classList.add(\"no-focus-outline\");\n        }, 500);\n    }, 800);\n}\n\nfunction installKeyboardMouseFocusHandler() {\n    let dateLastKeyboardEvent = new Date();\n    let dateLastMouseEvent = new Date();\n    document.body.addEventListener(\"focusin\", debounce((ev: any) => {\n        const focusWasTriggeredByMouse = dateLastMouseEvent > dateLastKeyboardEvent;\n        if (focusWasTriggeredByMouse) {\n            if (ev.target && ev.target.classList) {\n                ev.target.classList.add(\"no-focus-outline\");\n            }\n        }\n    }, 500));\n    document.body.addEventListener(\"focusout\", (ev: any) => {\n        if (ev.target && ev.target.classList) {\n            ev.target.classList.remove(\"no-focus-outline\");\n        }\n    });\n    document.body.addEventListener(\"mousedown\", () => {\n        dateLastMouseEvent = new Date();\n    });\n    document.body.addEventListener(\"keydown\", () => {\n        dateLastKeyboardEvent = new Date();\n    });\n}\n\nconst initFontSelector = () => {\n\n    const ID_PREFIX = \"fontselect_\";\n\n    const options: IRiotOptsMenuSelectItem[] =\n        [{\n            id: ID_PREFIX + \"DEFAULT\",\n            label: \"Default\",\n        }, {\n            id: ID_PREFIX + \"OLD\",\n            label: \"Old Style\",\n        }, {\n            id: ID_PREFIX + \"MODERN\",\n            label: \"Modern\",\n        }, {\n            id: ID_PREFIX + \"SANS\",\n            label: \"Sans\",\n        }, {\n            id: ID_PREFIX + \"HUMAN\",\n            label: \"Humanist\",\n        }, {\n            id: ID_PREFIX + \"DYS\",\n            label: \"Readable (dys)\",\n        }];\n    let selectedID = ID_PREFIX + electronStore.get(\"styling.font\");\n    const foundItem = options.find((item) => {\n        return item.id === selectedID;\n    });\n    if (!foundItem) {\n        selectedID = options[0].id;\n    }\n    const opts: IRiotOptsMenuSelect = {\n        disabled: !electronStore.get(\"styling.readiumcss\"),\n        options,\n        selected: selectedID,\n    };\n    const tag = riotMountMenuSelect(\"#fontSelect\", opts)[0] as IRiotTagMenuSelect;\n\n    tag.on(\"selectionChanged\", (val: string) => {\n        // console.log(\"selectionChanged\");\n        // console.log(val);\n        // const element = tag.root.ownerDocument.getElementById(val) as HTMLElement;\n        //     console.log(element.textContent);\n        val = val.replace(ID_PREFIX, \"\");\n        // console.log(val);\n        electronStore.set(\"styling.font\", val);\n    });\n\n    electronStore.onChanged(\"styling.font\", (newValue: any, oldValue: any) => {\n        if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n            return;\n        }\n        // console.log(\"onDidChange\");\n        // console.log(newValue);\n        tag.setSelectedItem(ID_PREFIX + newValue);\n\n        readiumCssOnOff();\n    });\n\n    electronStore.onChanged(\"styling.readiumcss\", (newValue: any, oldValue: any) => {\n        if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n            return;\n        }\n        tag.setDisabled(!newValue);\n    });\n\n    setTimeout(async () => {\n\n        let _sysFonts: string[] = [];\n        const systemFonts = new SystemFonts.default();\n        // const sysFonts = systemFonts.getFontsSync();\n        try {\n            _sysFonts = await systemFonts.getFonts();\n            // console.log(_sysFonts);\n        } catch (err) {\n            console.log(err);\n        }\n        if (_sysFonts && _sysFonts.length) {\n            const arr = ((tag.opts as IRiotOptsMenuSelect).options as IRiotOptsMenuSelectItem[]);\n            const divider: IRiotOptsMenuSelectItem = {\n                id: ID_PREFIX + \"_\",\n                label: \"_\",\n            };\n            arr.push(divider);\n            _sysFonts.forEach((sysFont) => {\n                const option: IRiotOptsMenuSelectItem = {\n                    id: ID_PREFIX + sysFont, // .replace(/ /g, \"_\"),\n                    label: sysFont,\n                };\n                arr.push(option);\n            });\n            let newSelectedID = ID_PREFIX + electronStore.get(\"styling.font\");\n            const newFoundItem = options.find((item) => {\n                return item.id === newSelectedID;\n            });\n            if (!newFoundItem) {\n                newSelectedID = arr[0].id;\n            }\n            (tag.opts as IRiotOptsMenuSelect).selected = newSelectedID;\n            tag.update();\n        }\n    }, 100);\n};\n\n// window.addEventListener(\"load\", () => {\n// });\n\nwindow.addEventListener(\"DOMContentLoaded\", () => {\n\n    window.document.addEventListener(\"keydown\", (ev: KeyboardEvent) => {\n        if (ev.keyCode === 37) { // left\n            navLeftOrRight(true);\n        } else if (ev.keyCode === 39) { // right\n            navLeftOrRight(false);\n        }\n    });\n\n    setTimeout(() => {\n        // material-components-web\n        (window as any).mdc.autoInit();\n    }, 500);\n\n    window.document.title = \"Readium2 [ \" + pathFileName + \"]\";\n\n    const h1 = document.getElementById(\"pubTitle\") as HTMLElement;\n    h1.textContent = pathFileName;\n\n    installKeyboardMouseFocusHandler();\n\n    if (electronStore.get(\"styling.night\")) {\n        document.body.classList.add(\"mdc-theme--dark\");\n    } else {\n        document.body.classList.remove(\"mdc-theme--dark\");\n    }\n\n    initFontSelector();\n\n    const snackBarElem = document.getElementById(\"snackbar\") as HTMLElement;\n    snackBar = new (window as any).mdc.snackbar.MDCSnackbar(snackBarElem);\n    (snackBarElem as any).mdcSnackbar = snackBar;\n    snackBar.dismissesOnAction = true;\n\n    const drawerElement = document.getElementById(\"drawer\") as HTMLElement;\n    drawer = new (window as any).mdc.drawer.MDCTemporaryDrawer(drawerElement);\n    (drawerElement as any).mdcTemporaryDrawer = drawer;\n    const drawerButton = document.getElementById(\"drawerButton\") as HTMLElement;\n    drawerButton.addEventListener(\"click\", () => {\n        drawer.open = true;\n    });\n\n    drawerElement.addEventListener(\"click\", (ev) => {\n        const allMenus = drawerElement.querySelectorAll(\".mdc-simple-menu\");\n        const openedMenus: Node[] = [];\n        allMenus.forEach((elem) => {\n            if ((elem as any).mdcSimpleMenu && (elem as any).mdcSimpleMenu.open) {\n                openedMenus.push(elem);\n            }\n        });\n\n        let needsToCloseMenus = true;\n        let currElem: Node | null = ev.target as Node;\n        while (currElem) {\n            if (openedMenus.indexOf(currElem) >= 0) {\n                needsToCloseMenus = false;\n                break;\n            }\n            currElem = currElem.parentNode;\n        }\n        if (needsToCloseMenus) {\n            openedMenus.forEach((elem) => {\n                (elem as any).mdcSimpleMenu.open = false;\n                const ss = (elem.parentNode as HTMLElement).querySelector(\".mdc-select__selected-text\");\n                if (ss) {\n                    (ss as HTMLElement).style.transform = \"initial\";\n                    (ss as HTMLElement).style.opacity = \"1\";\n                    (ss as HTMLElement).focus();\n                }\n            });\n        } else {\n            // console.log(\"NOT CLOSING MENU\");\n        }\n    }, true);\n\n    //     drawerElement.addEventListener(\"MDCTemporaryDrawer:open\", () => {\n    //         console.log(\"MDCTemporaryDrawer:open\");\n    //     });\n    //     drawerElement.addEventListener(\"MDCTemporaryDrawer:close\", () => {\n    //         console.log(\"MDCTemporaryDrawer:close\");\n    //     });\n\n    const menuFactory = (menuEl: HTMLElement) => {\n        const menu = new (window as any).mdc.menu.MDCSimpleMenu(menuEl);\n        (menuEl as any).mdcSimpleMenu = menu;\n        return menu;\n    };\n\n    const selectElement = document.getElementById(\"nav-select\") as HTMLElement;\n    const navSelector = new (window as any).mdc.select.MDCSelect(selectElement, undefined, menuFactory);\n    (selectElement as any).mdcSelect = navSelector;\n    navSelector.listen(\"MDCSelect:change\", (ev: any) => {\n        // console.log(\"MDCSelect:change\");\n        // console.log(ev);\n        // console.log(ev.detail.selectedOptions[0].textContent);\n        // console.log(ev.detail.selectedIndex);\n        // console.log(ev.detail.value);\n\n        const activePanel = document.querySelector(\".tabPanel.active\");\n        if (activePanel) {\n            activePanel.classList.remove(\"active\");\n        }\n        const newActivePanel = document.querySelector(\".tabPanel:nth-child(\" + (ev.detail.selectedIndex + 1) + \")\");\n        if (newActivePanel) {\n            newActivePanel.classList.add(\"active\");\n        }\n    });\n\n    const diagElem = document.querySelector(\"#lcpDialog\");\n    const lcpPassInput = document.getElementById(\"lcpPassInput\") as HTMLInputElement;\n    lcpDialog = new (window as any).mdc.dialog.MDCDialog(diagElem);\n    (diagElem as any).mdcDialog = lcpDialog;\n    lcpDialog.listen(\"MDCDialog:accept\", () => {\n\n        const lcpPass = lcpPassInput.value;\n\n        ipcRenderer.send(R2_EVENT_TRY_LCP_PASS, pathDecoded, lcpPass, false);\n    });\n    lcpDialog.listen(\"MDCDialog:cancel\", () => {\n\n        setTimeout(() => {\n            showLcpDialog();\n        }, 10);\n    });\n    if (lcpPassInput) {\n        lcpPassInput.addEventListener(\"keyup\", (ev) => {\n            if (ev.keyCode === 13) {\n                ev.preventDefault();\n                const lcpDialogAcceptButton = document.getElementById(\"lcpDialogAcceptButton\") as HTMLElement;\n                lcpDialogAcceptButton.click();\n            }\n        });\n    }\n\n    if (lcpHint) {\n\n        let lcpPassSha256Hex: string | undefined;\n        const lcpStore = electronStoreLCP.get(\"lcp\");\n        if (lcpStore) {\n            const pubLcpStore = lcpStore[pathDecoded];\n            if (pubLcpStore && pubLcpStore.sha) {\n                lcpPassSha256Hex = pubLcpStore.sha;\n            }\n        }\n        if (lcpPassSha256Hex) {\n            ipcRenderer.send(R2_EVENT_TRY_LCP_PASS, pathDecoded, lcpPassSha256Hex, true);\n        } else {\n            showLcpDialog();\n        }\n    } else {\n        startNavigatorExperiment();\n    }\n\n    const buttonClearSettings = document.getElementById(\"buttonClearSettings\") as HTMLElement;\n    buttonClearSettings.addEventListener(\"click\", () => {\n        // electronStore.clear();\n        // electronStore.store = electronStore.getDefaults();\n        electronStore.set(undefined, electronStore.getDefaults());\n\n        drawer.open = false;\n        setTimeout(() => {\n            const message = \"Settings reset.\";\n            const data = {\n                actionHandler: () => {\n                    // console.log(\"SnackBar OK\");\n                },\n                actionOnBottom: false,\n                actionText: \"OK\",\n                message,\n                multiline: false,\n                timeout: 2000,\n            };\n            snackBar.show(data);\n        }, 500);\n    });\n\n    const buttonClearSettingsStyle = document.getElementById(\"buttonClearSettingsStyle\") as HTMLElement;\n    buttonClearSettingsStyle.addEventListener(\"click\", () => {\n\n        electronStore.set(\"styling\", electronStore.getDefaults().styling);\n\n        drawer.open = false;\n        setTimeout(() => {\n            const message = \"Default styles.\";\n            const data = {\n                actionHandler: () => {\n                    // console.log(\"SnackBar OK\");\n                },\n                actionOnBottom: false,\n                actionText: \"OK\",\n                message,\n                multiline: false,\n                timeout: 2000,\n            };\n            snackBar.show(data);\n        }, 500);\n    });\n\n    const buttonOpenSettings = document.getElementById(\"buttonOpenSettings\") as HTMLElement;\n    buttonOpenSettings.addEventListener(\"click\", () => {\n        if ((electronStore as any).reveal) {\n            (electronStore as any).reveal();\n        }\n        if ((electronStoreLCP as any).reveal) {\n            (electronStoreLCP as any).reveal();\n        }\n    });\n\n    const buttonLSDRenew = document.getElementById(\"buttonLSDRenew\") as HTMLElement;\n    buttonLSDRenew.addEventListener(\"click\", () => {\n        ipcRenderer.send(R2_EVENT_LCP_LSD_RENEW, pathDecoded, \"\"); // no explicit end date\n    });\n\n    const buttonLSDReturn = document.getElementById(\"buttonLSDReturn\") as HTMLElement;\n    buttonLSDReturn.addEventListener(\"click\", () => {\n        ipcRenderer.send(R2_EVENT_LCP_LSD_RETURN, pathDecoded);\n    });\n\n    // const buttonDevTools = document.getElementById(\"buttonDevTools\") as HTMLElement;\n    //     buttonDevTools.addEventListener(\"click\", () => {\n    //         ipcRenderer.send(R2_EVENT_DEVTOOLS, \"test\");\n    //     });\n});\n\nipcRenderer.on(R2_EVENT_LCP_LSD_RENEW_RES, (_event: any, okay: boolean, msg: string) => {\n    console.log(\"R2_EVENT_LCP_LSD_RENEW_RES\");\n    console.log(okay);\n    console.log(msg);\n});\n\nipcRenderer.on(R2_EVENT_LCP_LSD_RETURN_RES, (_event: any, okay: boolean, msg: string) => {\n    console.log(\"R2_EVENT_LCP_LSD_RETURN_RES\");\n    console.log(okay);\n    console.log(msg);\n});\n\nconst saveReadingLocation = (doc: string, loc: string) => {\n    let obj = electronStore.get(\"readingLocation\");\n    if (!obj) {\n        obj = {};\n    }\n    obj[pathDecoded] = {\n        doc,\n        loc,\n    };\n    electronStore.set(\"readingLocation\", obj);\n};\n\nlet _webview1: Electron.WebviewTag;\nlet _webview2: Electron.WebviewTag;\n\nfunction createWebView(): Electron.WebviewTag {\n    const wv = document.createElement(\"webview\");\n    wv.setAttribute(\"webpreferences\",\n        \"nodeIntegration=0, nodeIntegrationInWorker=0, sandbox=0, javascript=1, \" +\n        \"contextIsolation=0, webSecurity=1, allowRunningInsecureContent=0\");\n    wv.setAttribute(\"partition\", R2_SESSION_WEBVIEW);\n    wv.setAttribute(\"httpreferrer\", publicationJsonUrl);\n    wv.setAttribute(\"preload\", \"./preload.js\");\n    wv.setAttribute(\"disableguestresize\", \"\");\n\n    wv.addEventListener(\"dom-ready\", () => {\n        // wv.openDevTools();\n\n        wv.clearHistory();\n    });\n\n    wv.addEventListener(\"ipc-message\", (event) => {\n        const webview = event.currentTarget as Electron.WebviewTag;\n        const activeWebView = getActiveWebView();\n        if (webview !== activeWebView) {\n            return;\n        }\n\n        if (event.channel === R2_EVENT_LINK) {\n            handleLink(event.args[0], undefined, false);\n        } else if (event.channel === R2_EVENT_WEBVIEW_READY) {\n            // const id = event.args[0];\n            unhideWebView(false);\n        } else if (event.channel === R2_EVENT_READING_LOCATION) {\n            const cssSelector = event.args[0];\n            if ((webview as any).READIUM2_LINK) {\n                saveReadingLocation((webview as any).READIUM2_LINK.Href, cssSelector);\n            }\n        } else if (event.channel === R2_EVENT_PAGE_TURN_RES) {\n            if (!_publication) {\n                return;\n            }\n            // const isRTL = _publication.Metadata &&\n            // _publication.Metadata.Direction &&\n            // _publication.Metadata.Direction.toLowerCase() === \"rtl\"; //  any other value is LTR\n\n            const messageString = event.args[0];\n            const messageJson = JSON.parse(messageString);\n            // const isRTL = messageJson.direction === \"RTL\"; //  any other value is LTR\n            const goPREVIOUS = messageJson.go === \"PREVIOUS\"; // any other value is NEXT\n\n            if (!(webview as any).READIUM2_LINK) {\n                console.log(\"WEBVIEW READIUM2_LINK ??!!\");\n                return;\n            }\n\n            let nextOrPreviousSpineItem: Link | undefined;\n            for (let i = 0; i < _publication.Spine.length; i++) {\n                if (_publication.Spine[i] === (webview as any).READIUM2_LINK) {\n                    if (goPREVIOUS && (i - 1) >= 0) {\n                        nextOrPreviousSpineItem = _publication.Spine[i - 1];\n                    } else if (!goPREVIOUS && (i + 1) < _publication.Spine.length) {\n                        nextOrPreviousSpineItem = _publication.Spine[i + 1];\n                    }\n                    break;\n                }\n            }\n            if (!nextOrPreviousSpineItem) {\n                return;\n            }\n            const linkHref = publicationJsonUrl + \"/../\" + nextOrPreviousSpineItem.Href;\n            handleLink(linkHref, goPREVIOUS, false);\n        } else {\n            console.log(\"webview1 ipc-message\");\n            console.log(event.channel);\n        }\n    });\n\n    return wv;\n}\n\nconst adjustResize = (webview: Electron.WebviewTag) => {\n    const width = webview.clientWidth;\n    const height = webview.clientHeight;\n    const wc = webview.getWebContents();\n    if (wc && width && height) {\n        wc.setSize({\n            normal: {\n                height,\n                width,\n            },\n        });\n    }\n};\n\nwindow.addEventListener(\"resize\", debounce(() => {\n    adjustResize(_webview1);\n    adjustResize(_webview2);\n}, 200));\n\nexport function handleLink(href: string, previous: boolean | undefined, useGoto: boolean) {\n    const prefix = publicationJsonUrl.replace(\"manifest.json\", \"\");\n    if (href.startsWith(prefix)) {\n        if (drawer.open) {\n            drawer.open = false;\n            setTimeout(() => {\n                loadLink(href, previous, useGoto);\n            }, 200);\n        } else {\n            loadLink(href, previous, useGoto);\n        }\n    } else {\n        shell.openExternal(href);\n    }\n}\n\nlet _viewHideInterval: NodeJS.Timer | undefined;\n\nfunction loadLink(hrefFull: string, previous: boolean | undefined, useGoto: boolean) {\n\n    if (!_publication) {\n        return;\n    }\n\n    const rcssJsonstr = computeReadiumCssJsonMessage();\n    // const str = window.atob(base64);\n    const rcssJsonstrBase64 = window.btoa(rcssJsonstr);\n\n    const linkUri = new URI(hrefFull);\n    linkUri.search((data: any) => {\n        // overrides existing (leaves others intact)\n\n        if (typeof previous === \"undefined\") {\n            // erase unwanted forward of query param during linking\n            data.readiumprevious = undefined;\n            // delete data.readiumprevious;\n        } else {\n            data.readiumprevious = previous ? \"true\" : \"false\";\n        }\n\n        if (!useGoto) {\n            // erase unwanted forward of query param during linking\n            data.readiumgoto = undefined;\n            // delete data.readiumgoto;\n        }\n\n        data.readiumcss = rcssJsonstrBase64;\n    });\n    if (useGoto) {\n        linkUri.hash(\"\").normalizeHash();\n    }\n\n    const pubUri = new URI(publicationJsonUrl);\n\n    // \"/pub/BASE64_PATH/manifest.json\" ==> \"/pub/BASE64_PATH/\"\n    const pathPrefix = pubUri.path().replace(\"manifest.json\", \"\");\n\n    // \"/pub/BASE64_PATH/epub/chapter.html\" ==> \"epub/chapter.html\"\n    const linkPath = linkUri.normalizePath().path().replace(pathPrefix, \"\");\n\n    let pubLink = _publication.Spine.find((spineLink) => {\n        return spineLink.Href === linkPath;\n    });\n    if (!pubLink) {\n        pubLink = _publication.Resources.find((spineLink) => {\n            return spineLink.Href === linkPath;\n        });\n    }\n\n    if (!pubLink) {\n        console.log(\"FATAL WEBVIEW READIUM2_LINK ??!!\");\n        return;\n    }\n\n    const activeWebView = getActiveWebView();\n    const wv1AlreadyLoaded = (_webview1 as any).READIUM2_LINK === pubLink;\n    const wv2AlreadyLoaded = (_webview2 as any).READIUM2_LINK === pubLink;\n    if (wv1AlreadyLoaded || wv2AlreadyLoaded) {\n        const msgJson = {\n            goto: useGoto ? linkUri.search(\"readiumgoto\") : undefined,\n            hash: useGoto ? undefined : linkUri.fragment(),\n            previous,\n        };\n        const msgStr = JSON.stringify(msgJson);\n\n        console.log(\"ALREADY LOADED: \" + pubLink.Href);\n        console.log(msgStr);\n\n        const webviewToReuse = wv1AlreadyLoaded ? _webview1 : _webview2;\n        // const otherWebview = webviewToReuse === _webview2 ? _webview1 : _webview2;\n        if (webviewToReuse !== activeWebView) {\n\n            console.log(\"INTO VIEW ...\");\n\n            const slidingView = document.getElementById(\"sliding_viewport\") as HTMLElement;\n            let animate = true;\n            if (msgJson.goto || msgJson.hash) {\n                console.log(\"DISABLE ANIM\");\n                animate = false;\n            } else if (previous) {\n                if (!slidingView.classList.contains(\"shiftedLeft\")) {\n                    console.log(\"DISABLE ANIM\");\n                    animate = false;\n                }\n            }\n            if (animate) {\n                if (!slidingView.classList.contains(\"animated\")) {\n                    slidingView.classList.add(\"animated\");\n                }\n            } else {\n                if (slidingView.classList.contains(\"animated\")) {\n                    slidingView.classList.remove(\"animated\");\n                }\n            }\n            if (slidingView.classList.contains(\"shiftedLeft\")) {\n                slidingView.classList.remove(\"shiftedLeft\");\n\n                // if (_webview1.classList.contains(\"posRight\")) {\n                //     // activeWebView === _webview1;\n                // } else {\n                //     // activeWebView === _webview2;\n                // }\n            } else {\n                slidingView.classList.add(\"shiftedLeft\");\n\n                // if (_webview2.classList.contains(\"posRight\")) {\n                //     // activeWebView === _webview1;\n                // } else {\n                //     // activeWebView === _webview2;\n                // }\n            }\n        }\n\n        webviewToReuse.send(R2_EVENT_SCROLLTO, msgStr); // .getWebContents()\n\n        return;\n    }\n\n    const hidePanel = document.getElementById(\"reader_chrome_HIDE\") as HTMLElement;\n    hidePanel.style.display = \"block\";\n    _viewHideInterval = setInterval(() => {\n        unhideWebView(true);\n    }, 5000);\n\n    const uriStr = linkUri.toString();\n    console.log(\"####### >>> ---\");\n    console.log((activeWebView as any).readiumwebviewid);\n    console.log(pubLink.Href);\n    console.log(linkUri.hash());\n    // tslint:disable-next-line:no-string-literal\n    console.log(linkUri.search(true)[\"readiumgoto\"]);\n    // tslint:disable-next-line:no-string-literal\n    console.log(linkUri.search(true)[\"readiumprevious\"]);\n    console.log(\"####### >>> ---\");\n    (activeWebView as any).READIUM2_LINK = pubLink;\n    activeWebView.setAttribute(\"src\", uriStr);\n    // wv.getWebContents().loadURL(uriStr, { extraHeaders: \"pragma: no-cache\\n\" });\n    // wv.loadURL(uriStr, { extraHeaders: \"pragma: no-cache\\n\" });\n\n    const enableOffScreenRenderPreload = false;\n    if (enableOffScreenRenderPreload) {\n        setTimeout(() => {\n            if (!_publication || !pubLink) {\n                return;\n            }\n\n            const otherWebview = activeWebView === _webview2 ? _webview1 : _webview2;\n\n            // let inSpine = true;\n            const index = _publication.Spine.indexOf(pubLink);\n            // if (!index) {\n            //     inSpine = false;\n            //     index = _publication.Resources.indexOf(pubLink);\n            // }\n            if (index >= 0 &&\n                previous && (index - 1) >= 0 ||\n                !previous && (index + 1) < _publication.Spine.length\n                // (index + 1) < (inSpine ? _publication.Spine.length : _publication.Resources.length)\n            ) {\n                const nextPubLink = _publication.Spine[previous ? (index - 1) : (index + 1)];\n                // (inSpine ? _publication.Spine[index + 1] : _publication.Resources[index + 1]);\n\n                if ((otherWebview as any).READIUM2_LINK !== nextPubLink) {\n                    const linkUriNext = new URI(publicationJsonUrl + \"/../\" + nextPubLink.Href);\n                    linkUriNext.normalizePath();\n                    linkUriNext.search((data: any) => {\n                        // overrides existing (leaves others intact)\n                        data.readiumcss = rcssJsonstrBase64;\n                    });\n                    const uriStrNext = linkUriNext.toString();\n\n                    console.log(\"####### ======\");\n                    console.log((otherWebview as any).readiumwebviewid);\n                    console.log(nextPubLink.Href);\n                    console.log(linkUriNext.hash());\n                    // tslint:disable-next-line:no-string-literal\n                    console.log(linkUriNext.search(true)[\"readiumgoto\"]);\n                    // tslint:disable-next-line:no-string-literal\n                    console.log(linkUriNext.search(true)[\"readiumprevious\"]);\n                    console.log(\"####### ======\");\n                    (otherWebview as any).READIUM2_LINK = nextPubLink;\n                    otherWebview.setAttribute(\"src\", uriStrNext);\n                }\n            }\n        }, 300);\n    }\n}\n\nconst getActiveWebView = (): Electron.WebviewTag => {\n\n    let activeWebView: Electron.WebviewTag;\n\n    const slidingViewport = document.getElementById(\"sliding_viewport\") as HTMLElement;\n    if (slidingViewport.classList.contains(\"shiftedLeft\")) {\n        if (_webview1.classList.contains(\"posRight\")) {\n            activeWebView = _webview1;\n        } else {\n            activeWebView = _webview2;\n        }\n    } else {\n        if (_webview2.classList.contains(\"posRight\")) {\n            activeWebView = _webview1;\n        } else {\n            activeWebView = _webview2;\n        }\n    }\n\n    return activeWebView;\n};\n\nlet _publication: Publication | undefined;\nlet _publicationJSON: any | undefined;\n\nfunction startNavigatorExperiment() {\n\n    const drawerButton = document.getElementById(\"drawerButton\") as HTMLElement;\n    drawerButton.focus();\n\n    _webview1 = createWebView();\n    (_webview1 as any).readiumwebviewid = 1;\n    _webview1.setAttribute(\"id\", \"webview1\");\n    _webview1.setAttribute(\"class\", \"full\");\n\n    _webview2 = createWebView();\n    (_webview2 as any).readiumwebviewid = 2;\n    _webview2.setAttribute(\"id\", \"webview2\");\n    _webview2.setAttribute(\"class\", \"full\");\n\n    const slidingViewport = document.getElementById(\"sliding_viewport\") as HTMLElement;\n    slidingViewport.appendChild(_webview1);\n    slidingViewport.appendChild(_webview2);\n\n    const nightSwitch = document.getElementById(\"night_switch-input\") as HTMLInputElement;\n    nightSwitch.checked = electronStore.get(\"styling.night\");\n    nightSwitch.addEventListener(\"change\", (_event) => {\n        const checked = nightSwitch.checked;\n        electronStore.set(\"styling.night\", checked);\n    });\n    nightSwitch.disabled = !electronStore.get(\"styling.readiumcss\");\n\n    const readiumcssSwitch = document.getElementById(\"readiumcss_switch-input\") as HTMLInputElement;\n    readiumcssSwitch.checked = electronStore.get(\"styling.readiumcss\");\n    readiumcssSwitch.addEventListener(\"change\", (_event) => {\n        const checked = readiumcssSwitch.checked;\n        electronStore.set(\"styling.readiumcss\", checked);\n    });\n\n    const basicSwitch = document.getElementById(\"nav_basic_switch-input\") as HTMLInputElement;\n    basicSwitch.checked = !electronStore.get(\"basicLinkTitles\");\n    basicSwitch.addEventListener(\"change\", (_event) => {\n        const checked = basicSwitch.checked;\n        electronStore.set(\"basicLinkTitles\", !checked);\n    });\n\n    // tslint:disable-next-line:no-floating-promises\n    (async () => {\n\n        let response: Response;\n        try {\n            response = await fetch(publicationJsonUrl);\n        } catch (e) {\n            console.log(e);\n            return;\n        }\n        if (!response.ok) {\n            console.log(\"BAD RESPONSE?!\");\n        }\n        // response.headers.forEach((arg0: any, arg1: any) => {\n        //     console.log(arg0 + \" => \" + arg1);\n        // });\n\n        try {\n            _publicationJSON = await response.json();\n        } catch (e) {\n            console.log(e);\n        }\n        if (!_publicationJSON) {\n            return;\n        }\n        // const pubJson = global.JSON.parse(publicationStr);\n\n        _publication = TAJSON.deserialize<Publication>(_publicationJSON, Publication);\n\n        const isRTL = _publication.Metadata &&\n            _publication.Metadata.Direction &&\n            _publication.Metadata.Direction.toLowerCase() === \"rtl\"; //  any other value is LTR\n        if (isRTL) {\n            _webview1.classList.add(\"posRight\");\n        } else {\n            _webview2.classList.add(\"posRight\");\n        }\n\n        if (_publication.Metadata && _publication.Metadata.Title) {\n            let title: string | undefined;\n            if (typeof _publication.Metadata.Title === \"string\") {\n                title = _publication.Metadata.Title;\n            } else {\n                const keys = Object.keys(_publication.Metadata.Title as IStringMap);\n                if (keys && keys.length) {\n                    title = (_publication.Metadata.Title as IStringMap)[keys[0]];\n                }\n            }\n\n            if (title) {\n                const h1 = document.getElementById(\"pubTitle\") as HTMLElement;\n                h1.textContent = title;\n            }\n        }\n\n        const buttonNavLeft = document.getElementById(\"buttonNavLeft\") as HTMLElement;\n        buttonNavLeft.addEventListener(\"click\", (_event) => {\n            navLeftOrRight(true);\n        });\n\n        const buttonNavRight = document.getElementById(\"buttonNavRight\") as HTMLElement;\n        buttonNavRight.addEventListener(\"click\", (_event) => {\n            navLeftOrRight(false);\n        });\n\n        if (_publication.Spine && _publication.Spine.length) {\n\n            const opts: IRiotOptsLinkList = {\n                basic: true,\n                fixBasic: true, // always single-line list items (no title)\n                links: _publicationJSON.spine as IRiotOptsLinkListItem[],\n                url: publicationJsonUrl,\n            };\n            // const tag =\n            riotMountLinkList(\"#reader_controls_SPINE\", opts);\n        }\n\n        if (_publication.TOC && _publication.TOC.length) {\n\n            const opts: IRiotOptsLinkTree = {\n                basic: electronStore.get(\"basicLinkTitles\"),\n                links: _publicationJSON.toc as IRiotOptsLinkTreeItem[],\n                url: publicationJsonUrl,\n            };\n            const tag = riotMountLinkTree(\"#reader_controls_TOC\", opts)[0] as IRiotTagLinkTree;\n\n            electronStore.onChanged(\"basicLinkTitles\", (newValue: any, oldValue: any) => {\n                if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n                    return;\n                }\n                tag.setBasic(newValue);\n            });\n        }\n        if (_publication.PageList && _publication.PageList.length) {\n\n            const opts: IRiotOptsLinkList = {\n                basic: electronStore.get(\"basicLinkTitles\"),\n                links: _publicationJSON[\"page-list\"] as IRiotOptsLinkListItem[],\n                url: publicationJsonUrl,\n            };\n            const tag = riotMountLinkList(\"#reader_controls_PAGELIST\", opts)[0] as IRiotTagLinkList;\n\n            electronStore.onChanged(\"basicLinkTitles\", (newValue: any, oldValue: any) => {\n                if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n                    return;\n                }\n                tag.setBasic(newValue);\n            });\n        }\n\n        const landmarksData: IRiotOptsLinkListGroupItem[] = [];\n        if (_publication.Landmarks && _publication.Landmarks.length) {\n            landmarksData.push({\n                label: \"Main\",\n                links: _publicationJSON.landmarks as IRiotOptsLinkListItem[],\n            });\n        }\n        if (_publication.LOT && _publication.LOT.length) {\n            landmarksData.push({\n                label: \"Tables\",\n                links: _publicationJSON.lot as IRiotOptsLinkListItem[],\n            });\n        }\n        if (_publication.LOI && _publication.LOI.length) {\n            landmarksData.push({\n                label: \"Illustrations\",\n                links: _publicationJSON.loi as IRiotOptsLinkListItem[],\n            });\n        }\n        if (_publication.LOV && _publication.LOV.length) {\n            landmarksData.push({\n                label: \"Video\",\n                links: _publicationJSON.lov as IRiotOptsLinkListItem[],\n            });\n        }\n        if (_publication.LOA && _publication.LOA.length) {\n            landmarksData.push({\n                label: \"Audio\",\n                links: _publicationJSON.loa as IRiotOptsLinkListItem[],\n            });\n        }\n        if (landmarksData.length) {\n            const opts: IRiotOptsLinkListGroup = {\n                basic: electronStore.get(\"basicLinkTitles\"),\n                linksgroup: landmarksData,\n                url: publicationJsonUrl,\n            };\n            const tag = riotMountLinkListGroup(\"#reader_controls_LANDMARKS\", opts)[0] as IRiotTagLinkListGroup;\n\n            electronStore.onChanged(\"basicLinkTitles\", (newValue: any, oldValue: any) => {\n                if (typeof newValue === \"undefined\" || typeof oldValue === \"undefined\") {\n                    return;\n                }\n                tag.setBasic(newValue);\n            });\n        }\n\n        const readStore = electronStore.get(\"readingLocation\");\n        let linkToLoad: Link | undefined;\n        let linkToLoadGoto: string | undefined;\n        if (readStore) {\n            const obj = readStore[pathDecoded];\n            if (obj && obj.doc) {\n                if (_publication.Spine && _publication.Spine.length) {\n                    linkToLoad = _publication.Spine.find((spineLink) => {\n                        return spineLink.Href === obj.doc;\n                    });\n                    if (linkToLoad && obj.loc) {\n                        linkToLoadGoto = obj.loc;\n                    }\n                }\n                if (!linkToLoad &&\n                    _publication.Resources && _publication.Resources.length) {\n                    linkToLoad = _publication.Resources.find((resLink) => {\n                        return resLink.Href === obj.doc;\n                    });\n                    if (linkToLoad && obj.loc) {\n                        linkToLoadGoto = obj.loc;\n                    }\n                }\n            }\n        }\n        if (!linkToLoad) {\n            if (_publication.Spine && _publication.Spine.length) {\n                const firstLinear = _publication.Spine[0];\n                if (firstLinear) {\n                    linkToLoad = firstLinear;\n                }\n            }\n        }\n\n        setTimeout(() => {\n            drawer.open = true; // necessary otherwise focus steal for links in publication documents!\n            if (linkToLoad) {\n                const hrefToLoad = publicationJsonUrl + \"/../\" + linkToLoad.Href +\n                    (linkToLoadGoto ? (\"?readiumgoto=\" + encodeURIComponent_RFC3986(linkToLoadGoto)) : \"\");\n                handleLink(hrefToLoad, undefined, true);\n            }\n        }, 100);\n    })();\n}\n\nfunction navLeftOrRight(left: boolean) {\n    if (!_publication) {\n        return;\n    }\n    const activeWebView = getActiveWebView();\n    const isRTL = _publication.Metadata &&\n        _publication.Metadata.Direction &&\n        _publication.Metadata.Direction.toLowerCase() === \"rtl\"; //  any other value is LTR\n    const goPREVIOUS = left ? !isRTL : isRTL;\n    const messageJson = {\n        direction: isRTL ? \"RTL\" : \"LTR\",\n        go: goPREVIOUS ? \"PREVIOUS\" : \"NEXT\",\n    };\n    const messageStr = JSON.stringify(messageJson);\n    activeWebView.send(R2_EVENT_PAGE_TURN, messageStr); // .getWebContents()\n}\n"]}